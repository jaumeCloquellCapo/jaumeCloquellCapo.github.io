{
    "version": "https://jsonfeed.org/version/1",
    "title": "jaumecloquellcapo",
    "description": "",
    "home_page_url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io",
    "feed_url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/feed.json",
    "user_comment": "",
    "author": {
        "name": "jaume cloquell capo"
    },
    "items": [
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/custom-error-types-with-golang.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/custom-error-types-with-golang.html",
            "title": "Returning Errors",
            "summary": "I’ve spent a lot of time thinking about the best way to handle errors in Go programs. I really wanted there to be a single way to do error handling, something that we could teach all Go programmers by rote, just as we might teach mathematics, or&hellip;",
            "content_html": "<p>I’ve spent a lot of time thinking about the best way to handle errors in Go programs. I really wanted there to be a single way to do error handling, something that we could teach all Go programmers by rote, just as we might teach mathematics, or the alphabet.</p>\n<p>However, I have concluded that there is no single way to handle errors. Instead, I believe Go’s error handling can be classified into the two core strategies.</p>\n<h1> </h1>\n<h1 id=\"sentinel errors\">Sentinel errors</h1>\n<p>The first category of error handling is what I call <i>sentinel errors</i>. The name descends from the practice in computer programming of using a specific value to signify that no further processing is possible. </p>\n<p>The default behavior returns an error with a message. An example is doing a sql query where we bubble up <code class=\"language-text\">ErrNoRows</code> and return 404 for that error but 500 for other errors:</p>\n<pre>res, err := r.db.Exec(query, UserSignUp.Name, UserSignUp.Password, UserSignUp.Email)<br>if err != nil {<br>   if err != sql.ErrNoRows {<br>      return 404<br>   }<br>   return 500<br>}</pre>\n<p>These types of errors are called sentinel errors, the benefit is we can check against their type, but the downside is our http handler now needs to import the <code class=\"language-text\">database/sql</code> package and we have no stack traces. </p>\n<h1> </h1>\n<h1>Error types</h1>\n<p>Error types are the second form of Go error handling I want to discuss.</p>\n<p>An error type is a type that you create that implements the error interface. This is where a package like <code class=\"language-text\">errors</code> comes in.</p>\n<pre>package error<br><br>type ErrorNotFound struct{ msg string }<br><br>func (e *ErrorNotFound) IsNotFound() bool { return true }<br>func (e *ErrorNotFound) Error() string    { return e.msg }<br><br>type IErrorNotFound interface {<br>   error<br>   IsNotFound() bool<br>}<br>func NewErrorNotFound(msg string) error {<br>   return &amp;ErrorNotFound{msg}<br>}</pre>\n<p>A potential way to improve would be not requiring the handler to import <code class=\"language-text\">ErrorNotFound</code>. A way to get around that would be to type assert on behavior instead of types. Where if our <code>ErrorNotFound</code> instead conformed to an interface, we could check against that, and just import an interface instead of a struct:</p>\n<pre><br>...<br>   if err != nil {<br>      if err != sql.ErrNoRows {<br>         return model.User{}, error2.NewErrorNotFound(fmt.Sprintf(\"Error: User not found by email %s\", email))<br>      }<br><br>      return model.User{}, err<br>   }<br><br>...</pre>\n<pre>user, err := uc.service.GetUserById(id)<br>if err, ok := err.(errorNotFound.IErrorNotFound); ok &amp;&amp; err.IsNotFound() {<br>   c.Status(http.StatusNotFound)<br>}</pre>\n<p><a href=\"https://github.com/jaumeCloquellCapo/go-api-boirplate\" target=\"_blank\" rel=\"noopener noreferrer\">Github</a></p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/22/error-ok.jpeg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Golang"
            ],
            "date_published": "2020-12-08T13:50:41+01:00",
            "date_modified": "2020-12-08T21:30:56+01:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/prevent-re-renders-on-react.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/prevent-re-renders-on-react.html",
            "title": "Prevent re-renders on React",
            "summary": "In most cases, React performance is not something you need to worry about. The core library does a ton of work under the hood to make sure everything is rendering efficiently. However, occasionally you can run into scenarios where your components are rendering more often&hellip;",
            "content_html": "<p>In most cases, React performance is not something you need to worry about. The core library does a ton of work under the hood to make sure everything is rendering efficiently. However, occasionally you can run into scenarios where your components are rendering more often than they need to and slowing your site down.</p>\n<p>To understand why hooks need to remember (memoize), we need to understand the motivation behind memoization in React. <a href=\"https://en.wikipedia.org/wiki/Memoization\">Memoization</a> in programming is a computation strategy where functions remember the output of their previous execution, then uses it as a factor for the next computation. Usually, the function would try to run for each computation in a range of data but instead, it runs only once for the next range then factors the previous result.</p>\n<p>In this article, I’ll demonstrate with a few simple examples why we need these hooks and when and how to use them. This is not an introduction to hooks, and you must be familiar with the <a href=\"https://reactjs.org/docs/hooks-reference.html#usestate\">useState</a> hook to follow.</p>\n<p> </p>\n<h1 id=\"the-problem\">Case Study</h1>\n<p>Before we start, let’s introduce a helper button component. We’ll use <a href=\"https://reactjs.org/docs/react-api.html#reactmemo\">React.memo</a> to turn it into a memoized component. This will force React to never re-render it, unless some of its properties change. We’ll also add a random colour as its background so we can track when it re-rerenders:</p>\n<div class=\"post__iframe\"><iframe loading=\"lazy\" style=\"width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;\" src=\"https://codesandbox.io/embed/charming-night-6d34n?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" title=\"charming-night-6d34n\" allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\" sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"></iframe></div>\n<p>Now let’s look at the following simple app. It displays 2 numbers - a counter <code class=\"language-plaintext highlighter-rouge\">Beta</code> and a <code class=\"language-plaintext highlighter-rouge\">delta</code>. One button allows the user to increment <code class=\"language-plaintext highlighter-rouge\">delta</code> by 1. A second button, allows the user to increment the counter by adding <code class=\"language-plaintext highlighter-rouge\">delta</code> to it</p>\n<p>In this example, any changes to data will cause <code><em>App</em></code> to re-render all of it's child components, including the <code>Button</code> component, even if title didn't change. . In this case it's probably not a big deal, but if <code><em>&lt;Button/&gt;</em></code> was performing some expensive computation every time it rendered we would want to make sure it was only rendering when necessary.</p>\n<p>When using class based components, <code>PureComponent</code> will return the last rendered value if the passed in props are the same. There is also a <code><em>shouldComponentUpdate</em></code> function for more fine tuned control. When using functional components, React provides three methods of optimization that this article will be focusing on: <code>React.memo, useMemo, </code>and<code> useCallback.</code></p>\n<h2>useCallback</h2>\n<p><code><em>useCallback</em></code> can prevent unnecessary renders between parent and child components. It takes as an argument a function and returns a cached/memoized version of it.</p>\n<div class=\"post__iframe\"><iframe loading=\"lazy\" style=\"width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;\" src=\"https://codesandbox.io/embed/beautiful-elbakyan-k6bx6?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" title=\"beautiful-elbakyan-k6bx6\" allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\" sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"></iframe></div>\n<p>Now <code class=\"language-plaintext highlighter-rouge\">increment</code> will have the same value until <code class=\"language-plaintext highlighter-rouge\">delta</code> changes, which will reduce the number of times renders. The <code class=\"language-plaintext highlighter-rouge\">useCallback</code> hook has created a single cached version of <code class=\"language-plaintext highlighter-rouge\">increment</code>, which encapsulates the <strong>initial value</strong> of <code class=\"language-plaintext highlighter-rouge\">delta</code>. When <code class=\"language-plaintext highlighter-rouge\">App</code> re-renders with different values for <code class=\"language-plaintext highlighter-rouge\">delta</code>, <code class=\"language-plaintext highlighter-rouge\">useCallback</code> returns the previous version of the <code class=\"language-plaintext highlighter-rouge\">increment</code> function which keeps the old value of <code class=\"language-plaintext highlighter-rouge\">delta</code> from the first rendering.</p>\n<p>We need to tell <code class=\"language-plaintext highlighter-rouge\">useCallback</code> to create new cached version of <code class=\"language-plaintext highlighter-rouge\">increment</code> for every change of <code class=\"language-plaintext highlighter-rouge\">delta</code> ( the the second argument)</p>\n<h2>React.Memo</h2>\n<p><code>React.memo</code> is a higher order component that memoizes the result of a function component. If a component returns the same result given the same props, wrapping it in memo can result in a performance boost. In other words useMemo caches a computed value. This is usefull when the computation requires significant resources and we don’t want to repeat it on every re-render<br><br>To see the differences  between  use <code>React.memo</code> or not, we define two components, header and subheader. The first components is wrapper using React.memo and the other not.  Also exist a button allows the user to increment a counter by <br><br>In this example, any changes to data will cause App to re-render all of it's child components, including the <code>&lt;SubHeader&gt;</code> and <code>&lt;Header&gt;</code> component, even if title didn't change. <br><br>We can come to the conclusion that this component not need to be rendered unless title changes, so it would be safe to wrap it in React.memo.‍Instead of skipping the render-step like in class based components, <code>React.memo</code> will reuse the last rendered result instead of calculating a new result.<br><br>This occur because  React.memo will reuse the last rendered result instead of calculating a new result in the case the <code>&lt;Header /&gt;</code> component</p>\n<div class=\"post__iframe\"><iframe loading=\"lazy\" style=\"width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;\" src=\"https://codesandbox.io/embed/solitary-brook-l8704?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" title=\"solitary-brook-l8704\" allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\" sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"></iframe></div><code class=\"css-b4nh06\"></code></p>\n<h2>useMemo</h2>\n<p>While <code>React.memo</code> is a <a href=\"https://reactjs.org/docs/higher-order-components.html\" class=\"css-19gwvxx\">higher-order component</a> as it accepts a component and returns the new/memoized <strong class=\"css-0\">component</strong>.<code>React.useMemo</code> is a <a href=\"https://reactjs.org/docs/hooks-intro.html\">hook</a>(which is a function). It accepts a function and returns the memoized return value of the function you passed.<code class=\"  language-js\"></code></p>\n<pre class=\"language-js prism-code language-javascript css-0\"><span class=\"token plain\">const value </span><span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">useMemo</span><span class=\"token punctuation\">(<br></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token function\">computeExpensiveValue</span><span class=\"token punctuation\">(</span><span class=\"token plain\">a</span><span class=\"token punctuation\">,</span><span class=\"token plain\"> b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token plain\">a</span><span class=\"token punctuation\">,</span><span class=\"token plain\"> b</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><code class=\"  language-js\"></code></pre>\n<p>Using useMemo will memoize the result, so if widgets haven't changed since the component's last render it will skip the function call and return what it got last.‍</p>\n<h2>Conclusions</h2>\n<p id=\"c9ec\" class=\"jy jz hb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv gt cq\" data-selectable-paragraph=\"\">The main difference between the <code class=\"css-b4nh06\">React.useMemo</code> and <code class=\"css-b4nh06\">React.useCallback</code> is that <code class=\"css-b4nh06\">React.useCallback</code> returns a memoized callback and <code class=\"css-b4nh06\">React.useMemo</code> returns a memoized value that is the result of the function parameter.</p>\n<p id=\"e659\" class=\"jy jz hb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv gt cq\" data-selectable-paragraph=\"\">If you have to process a lot of data, ‘useMemo’ is the perfect Hook as it will do the work once at the first render and then return a cached version on every other render.</p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/20/pexels-pixabay-87089.jpg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Reactjs",
                   "JavaScript"
            ],
            "date_published": "2020-09-09T16:09:58+02:00",
            "date_modified": "2020-09-10T12:47:05+02:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/intersection-observer-api.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/intersection-observer-api.html",
            "title": "Intersection Observer API in React",
            "summary": "Modern web applications use a lot of animations and media ranging from images, gif, videos to SVG’s to make user experience elegant and engaging. If not handled properly, it can hamper your website’s performance, and these things might not work in your favour. To overcome&hellip;",
            "content_html": "<article class=\"structure__article structure__long-form\">\n<p>Modern web applications use a lot of animations and media ranging from images, gif, videos to SVG’s to make user experience elegant and engaging. If not handled properly, it can hamper your website’s performance, and these things might not work in your favour. To overcome this issue of over-fetching resources, we need to handle the media on our website more sincerely and display them only when necessary, the jargon for which is lazy loading.</p>\n<p>Native observers empower your JavaScript to subscribe to events like the alteration of the DOM, an elements position in relation to the viewport and even the resizing of individual elements. Each observer follows a similar pattern to construct and they offload complicated and sometimes tightly coupled functionality to the browser.</p>\n<p>In this post, I’ll talk about the intersection and observation process and how they relate to the threshold and browser viewport.. To explain our intersection observer, we will implement a <em>lazy loading</em> using Intersection observer in react.</p>\n<h2>Get the images by url</h2>\n<p>At this point we're going to do a little cheating, since if we were using a conventional REST API, we should get the list of photos and then get the resource associated with the image sprites of each photo. All the sprites are under the same URL:</p>\n<pre class=\"prettyprint prettyprinted\"><code>export default async function fetchPhotos () {</code><br><code>    return await Array.apply(null, { length: 150 })</code><br><code>        .map((item, index) =&gt; {</code><br><code>            return {</code><br><code>                id: index + 1,</code><br><code>                sprite: `https://picsum.photos/200/300?random=${index}`</code><br><code>            }</code><br><code>        })</code><br><code>}</code></pre>\n<p> </p>\n<h2>Implementing the Intersection Observer in a gallery of photos</h2>\n<p>The goal I want to achieve is to avoid loading images that appear below the viewport but, at the same time, to achieve a fluid user experience so that you do not notice that you are doing this downloading of images in delay.The intersection observer allows you to watch when an element intersects with the viewport.<br><br>An intersection observer follows the following pattern to set up: we need to define our observer and a callback function to fire when our conditions are met:</p>\n<pre class=\"prettyprint prettyprinted\"><code class=\"prettyprint\"><span class=\"kwd\">const</span><span class=\"pln\"> observer </span><span class=\"pun\">=</span> <span class=\"kwd\">new</span> <span class=\"typ\">IntersectionObserver</span><span class=\"pun\">(</span><span class=\"pln\">intersectionCallback</span><span class=\"pun\">);</span></code></pre>\n<p>The fields of options object are as follows:</p>\n<ul>\n<li><strong>root: </strong>The element that is used as the viewport for checking the visibility of the target. If the value is provided as null or not specified, then it will take the browser’s viewport.</li>\n<li><strong>rootMargin:</strong> This set of values serves to grow or shrink each side of the root element's bounding box before computing intersections. It accepts values in a similar fashion as CSS e.g. \"5px 10px 5px 10px\".</li>\n<li><strong>threshold:</strong> Either a single number or an array of numbers which indicate at what percentage of the target's visibility, the observer's callback should be executed. Its value ranges from 0 to 1.0, where 0 symbolises that one pixel is visible and 1.0 means every pixel is visible in the viewport.</li>\n</ul>\n<p>Now we will select all target elements and observe them.</p>\n<p><code class=\"prettyprint prettyprinted\"><span class=\"pln\">observer</span><span class=\"pun\">.</span><span class=\"pln\">observe</span><span class=\"pun\">(</span><span class=\"pln\">document</span><span class=\"pun\">.</span><span class=\"pln\">querySelector</span><span class=\"pun\">(‘.</span><span class=\"pln\">yourElement</span><span class=\"pun\">’));</span></code></p>\n<p>Finally our callback, which we called <code><span class=\"token\">lazyLoadImage</span></code> above. </p>\n<pre><code><span class=\"token module\">export</span> <span class=\"token module\">default</span> <span class=\"token\">function</span> <span class=\"token\">lazyLoadImage</span><span class=\"token\">(</span><span class=\"token parameter\">entries</span><span class=\"token parameter token\">,</span><span class=\"token parameter\"> observer</span><span class=\"token\">)</span> <span class=\"token\">{</span>\n  entries<span class=\"token\">.</span><span class=\"token method property-access\">forEach</span><span class=\"token\">(</span><span class=\"token\">(</span><span class=\"token parameter\">entry</span><span class=\"token\">)</span> <span class=\"token arrow\">=&gt;</span> <span class=\"token\">{</span>\n    <span class=\"token\">if</span> <span class=\"token\">(</span>entry<span class=\"token\">.</span><span class=\"token property-access\">isIntersecting</span><span class=\"token\">)</span> <span class=\"token\">{</span>\n      observer<span class=\"token\">.</span><span class=\"token method property-access\">unobserve</span><span class=\"token\">(</span>entry<span class=\"token\">.</span><span class=\"token property-access\">target</span><span class=\"token\">)</span><span class=\"token\">;</span>\n      entry<span class=\"token\">.</span><span class=\"token property-access\">target</span><span class=\"token\">.</span><span class=\"token property-access\">src</span> <span class=\"token\">=</span> entry<span class=\"token\">.</span><span class=\"token property-access\">target</span><span class=\"token\">.</span><span class=\"token property-access\">dataset</span><span class=\"token\">.</span><span class=\"token property-access\">src</span><span class=\"token\">;</span>\n    <span class=\"token\">}</span>\n  <span class=\"token\">}</span><span class=\"token\">)</span><span class=\"token\">;</span>\n<span class=\"token\">}</span></code></pre>\n<p>In this callback, we say “Hey - intersectionObserver, every time one of our image containers hits the viewport (<code class=\"prettyprint prettyprinted\"><span class=\"pun\"><code><span class=\"token property-access\">isIntersecting</span></code></span> </code>), load the image (<code>entry<span class=\"token\">.</span><span class=\"token property-access\">target</span><span class=\"token\">.</span><span class=\"token property-access\">src</span> <span class=\"token\">=</span> entry<span class=\"token\">.</span><span class=\"token property-access\">target</span><span class=\"token\">.</span><span class=\"token property-access\">dataset</span><span class=\"token\">.</span><span class=\"token property-access\">src</span><span class=\"token\">;</span></code><code class=\"prettyprint prettyprinted\"></code>)”. And that’s it - no more fragile viewport calculations. </p>\n<p>While lazy loading images is an immediate choice, it can be useful in all sorts of applications like flyouts and triggered animations.</p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/19/deepin-screen-recorder_Navigator_20200903181023.gif\" alt=\"\" width=\"1920\" height=\"972\"></figure>\n<p><a href=\"https://github.com/jaumeCloquellCapo/react-intersection-observer\" target=\"_blank\" rel=\"noopener noreferrer\">Github</a></p>\n</article>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/19/images.jpeg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Reactjs",
                   "JavaScript"
            ],
            "date_published": "2020-09-03T18:11:58+02:00",
            "date_modified": "2020-09-10T12:47:40+02:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/sharpe-ratio-risk.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/sharpe-ratio-risk.html",
            "title": "Portfolio Optimization Based on Sharpe Ratio and Genetic Algorithm",
            "summary": "This post shows the application of the theory of genetic algorithms to an optimization problem of a portfolio of shares. Both of the optimization problems and the theory of genetic algorithms are exposed briefly and are useful to solve a specific problems, to find the best assignment&hellip;",
            "content_html": "<p>This post shows the application of the theory of genetic algorithms to an optimization problem of a portfolio of shares. Both of the optimization problems and the theory of genetic algorithms are exposed briefly and are useful to solve a specific problems, to find the best assignment when it is necessary to invest. The exposition of this interesting topic is helped by software that allows seeing the step-by-step optimization process by using genetic algorithms.</p>\n<p>For the present post we use the portfolio selection model of Markowitz (1952), using the performance measurement for mutual fund portfolios proposed by Sharpe (1964), a measure that was originally called reward-to-variability ratio and became popular as Sharpe's index, measure or ratio. The following are the basic elements of the Markowitz portfolio selection model and the Sharpe ratio as a measure of performance and optimization of the return/risk ratio.</p>\n<p><span style=\"font-size: inherit;\">In particular, we're going to cover:</span></p>\n<div class=\"post__toc\">\n<h3> </h3>\n<ul>\n<li><a href=\"#mcetoc_1e4h1dsdl7\">Introduction</a>\n<ul>\n<li><a href=\"#mcetoc_1e4h1ddts6\">Modern Portfolio Theory</a></li>\n<li><a href=\"#mcetoc_1e4f8ehqf1\">Sharpe Ratio</a></li>\n</ul>\n</li>\n<li><a href=\"#mcetoc_1e4grpbd33\"> Proposed Methodology</a></li>\n<li><a href=\"#mcetoc_1e4h2fd850\">Portfolio Optimization Using GA</a>\n<ul>\n<li><a href=\"#mcetoc_1e4gr7i3a1\">Parameterization of the algorithm</a></li>\n<li><a href=\"#mcetoc_1e4h3hqtn0\">Representation</a></li>\n<li><a href=\"#mcetoc_1e4f92ij72\">Crossing</a></li>\n<li><a href=\"#mcetoc_1e4fb64sj1\">Fitting function</a></li>\n<li><a href=\"#mcetoc_1e4fcn20s0\">Early stop</a></li>\n</ul>\n</li>\n<li><a href=\"#mcetoc_1e4fd036u0\">Case studies</a></li>\n<li><a href=\"#mcetoc_1e44o9k7t0\">Bibliography</a></li>\n</ul>\n</div>\n<br>\n<h2 id=\"mcetoc_1e4h1dsdl7\">Introduction</h2>\n<p id=\"mcetoc_1e4h1dugj8\">Stock selection is a critically important issue when it comes to investing in the stock market, and the first problem that investors encounter. When investors select stocks, they consider the risk and the return of the stock. However, a single stock with high return usually entails high risk, while a single stock with low risk entails low return. Investors naturally want to invest in stocks with low risk and high return. The fluctuation of stock price can represent the risk of this stock. As the proverb says, “Do not put all your eggs in one basket.” In order to stabilize the fluctuation of stocks, we aggregate different stocks in a portfolio because a good combination of stocks is able to reduce the holistic risk and increase the return. Therefore, this post provides a portfolio which simultaneously considers risk and return to investors.</p>\n<div id=\"sec3b\" class=\"section_2\">\n<h3 id=\"mcetoc_1e4h1ddts6\">Modern Portfolio Theory</h3>\n<p id=\"mcetoc_1e4h1hip49\">The concept of diversification was formalized with the Modern Theory of Finance. This is how Markowitz (1952) presented a portfolio selection model that incorporated the principles of diversification, identifying a set of efficient portfolios, or the efficient frontier of risky assets. The main idea of this set of risky portfolios is that, for any level of risk, only the portfolio with the highest expected return is of interest. Alternatively, the frontier is the set of portfolios that minimizes the variance for any expected return goal.</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/chou4-2756842-small.gif\" alt=\"\" width=\"550\" height=\"146\"></figure><br><br>The application of this model corresponds, in the first instance, to determining the risk-return opportunities available to the investor, which are summarized in the frontier of minimum variance of risky assets. This agrees with the minimum possible variance that can be obtained given the expected return of a portfolio. From the data on expected returns, variance and covariances, the minimum-variance portfolio can be calculated for any level of expected return.<br><br>However, it is important to consider that Markowitz develops its model based on the following assumptions:</p>\n<ol>\n<li>The return of any asset or portfolio is described by a subjective random variable, whose probability distribution for the reference period is known to the investor;</li>\n<li>The risk of an asset or portfolio is measured by the variance (or standard deviation, σ) of the random variable representative of its return;</li>\n<li>The investor will prefer financial assets that have a higher return for a given risk, or a lower risk for a known return. This decision rule is called rational investor behaviour, it assumes that investors are risk averse;</li>\n<li>There are no market \"imperfections\" such as taxes and transaction costs</li>\n</ol>\n<p>Following portfolio theory, methods and indicators for the evaluation of risk-adjusted performance using the mean-variance criterion appeared, such as the contributions of Treynor (1965), Sharpe (1966) and Jensen (1968), who agreed that the performance of a portfolio, in terms of return and risk, could be evaluated jointly. This post focuses particularly on William Sharpe's approach, since his indicator (Sharpe's ratio) comes from a simplifying model of the Markowits portfolio selection model, by reducing the number of data required for its use. </p>\n</div>\n<h3 id=\"mcetoc_1e4f8ehqf1\"><strong>Sharpe Ratio</strong></h3>\n<p>The Sharpe ratio was proposed by William Sharpe, a winner of the Nobel Memorial Prize in Economic Sciences in 1990. The Sharpe ratio is based on the capital asset pricing model, which is one of the basic and significant investment theories. The Sharpe ratio is utilized to measure the performance of a stock; it is a representative index to assess stocks. Choosing and holding the portfolio which has low risk and high return is the purpose of the Sharpe ratio. The formula of the Sharpe ratio is given by formula  where <span id=\"MathJax-Element-13-Frame\" class=\"MathJax\" tabindex=\"0\"><span id=\"MathJax-Span-216\" class=\"math\"><span id=\"MathJax-Span-217\" class=\"mrow\"><span id=\"MathJax-Span-218\" class=\"msubsup\"><span id=\"MathJax-Span-219\" class=\"mi\">R</span><span id=\"MathJax-Span-220\" class=\"texatom\"><span id=\"MathJax-Span-221\" class=\"mrow\"><span id=\"MathJax-Span-222\" class=\"mi\">f</span></span></span></span></span></span></span> is the risk-free rate of interest. By selecting the higher Sharpe ratio, investors invest in the portfolio which has minimal investment risk with the same amount of return or maximal return with the same investment risk:</p>\n<div><figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"data:image/png;base64,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\" data-is-external-image=\"true\"  alt=\"Ratio de Sharpe - Qué es, definición y concepto | Economipedia\" width=\"172\" height=\"143\" data-noaft=\"1\"></figure></div>\n<p>where r is the return on the portfolio, $r_{rf}$ is the risk-free return and $\\sigma$ is the <a href=\"https://mathworld.wolfram.com/StandardDeviation.html\">standard deviation</a> of the fund's returns.</p>\n<p>Given the nature of this new objective function, it is clear that both any increase in performance and any decrease in risk will increase the value of the function.  </p>\n<h2 id=\"mcetoc_1e4grpbd33\"> Proposed Methodology</h2>\n<p>To explore the efficiency of the market portfolio, this paper contrasts the performance with a hypothetical portfolio that optimizes the risk-return ratio using data observed for 1 year, following the strategy of the portfolio theory from an algorithm that maximizes the Sharpe ratio. <br><br>Our method combines the Sharpe ratio and genetic algorithms (GA) to solve the problem of stock selection. Because this paper does not restrict the stock number of a portfolio, there are massive combinations in the search space. GA is utilized to find the best assignment of portfolio that has the low risk and high return in the huge search space.</p>\n<p>For the development of this optimization model it is necessary to consider the following criteria that have been defined in order to obtain a reliable and properly structured database:</p>\n<ul>\n<li>The information used for portfolio optimization considers a representative index of the Spanish equity market, for which the IBEX35 was selected, which is composed of the most representative shares of the market in that country.</li>\n<li>The sample used for the optimization is a daily frequency.</li>\n<li>The closing prices obtained through the Yahoo international information terminal, are used and the actual daily returns are subsequently calculated.</li>\n</ul>\n<h2 id=\"mcetoc_1e4h2fd850\">Portfolio Optimization Using GA</h2>\n<p>As we explained in the previous <a href=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/introduccion-a-los-algoritmos-geneticos.html\">post</a>, an optimization problem is about choosing the values of the decision variables that will optimize the objective function within a solution space. Unlike classical methods of optimization, the genetic algorithm does not choose an initial solution but a set of solutions known as the initial population. Some of the phases of a genetic algorithm are as follows:</p>\n<ul>\n<li>Fitting function</li>\n<li>Selection method</li>\n<li>Genetic operations:\n<ul>\n<li>Crossing</li>\n<li>Mutation</li>\n</ul>\n</li>\n<li>Generation of new population</li>\n</ul>\n<h3 id=\"mcetoc_1e4gr7i3a1\">Parameterization of the algorithm</h3>\n<p>Although the results are dependent to a greater or lesser extent on the particular problem, the parameters were chosen according to the following criteria:</p>\n<ul>\n<li><strong>Population size:</strong> in general terms, the initial population should be as varied as possible. The distribution of skills needs to be uniform to avoid premature convergence, and there also needs to be a variety of patterns. Population size varies between 50 and 100 individuals; smaller values often pose serious problems of premature convergence and larger values require a large computational effort without appreciable improvement. Different initial populations were evaluated; the performance evaluation in the different examples shows that the best results are observed when the initial population varies between 60 and 150 individuals. In the final algorithm, an initial population of 100 elements was chosen.</li>\n<li><strong>Mutation probability:</strong> the best performances are obtained in general, with crossing rates varying between 20% and 60% and mutation rates between 0.1% and 5%. Although there is no particular criterion for choosing a given value, a mutation probability of 5% and a crossing rate of 20% (number of parents to be selected) were chosen, since different authors have recommended these parameters.</li>\n<li><strong>Maximum generations:</strong> the maximum number of iterations depends on the specified precision and varies greatly from one problem to another; it is common to use a maximum iteration of 50 for complex assessment problems and a maximum iteration of 1,000 for simple assessment problems. For the present approach it was decided to use a maximum iteration of 200.</li>\n</ul>\n<h3 id=\"mcetoc_1e4h3hqtn0\">Representation</h3>\n<p id=\"mcetoc_1e4h3htsf1\">In the encoding with GA in our method, chromosome represents the weights which are assignmed in the portfolio. <br><br>Our key constraint is that all the portfolio weights should sum to 1.0. What this means, practically, is that all of our cash should be invested in an asset.</p>\n<h3 id=\"mcetoc_1e4f92ij72\">Crossing</h3>\n<p id=\"mcetoc_1e4f90h3m1\">The objective of the crossing is to generate, from individuals already existing (parental), new individuals (offspring) combining the characteristics of the previous ones. In this post we have implemented two strategies although there are more ont the literature.</p>\n<ul>\n<li>Crossing from a single point: randomly selected a position that acts as a cut-off point. Each individual parent is divide into two parts and exchange the halves. As a result of this process, for every crossing, two new individuals are generated.</li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://www.tutorialspoint.com/genetic_algorithms/images/multi_point_crossover.jpg\" data-is-external-image=\"true\"  alt=\"Genetic Algorithms - Crossover - Tutorialspoint\" width=\"600\" height=\"143\" data-noaft=\"1\"></figure>\n<ul>\n<li>Uniform crossing: the value that each position of the new individual is obtained from one of the two parents. Usually, the probability of the value coming from each parent is the same, although it could, for example, be conditioned by one's fitness.<br> Unlike the previous strategies, with this one, each crossing is generates a single offspring.</li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"data:image/png;base64,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\" data-is-external-image=\"true\"  alt=\"Example of uniform crossover | Download Scientific Diagram\" width=\"363\" height=\"139\" data-noaft=\"1\"></figure>\n<p>Below, you can see the implementation. The first step consist to extract a copy from one parent to create te new children.  Depens of the configuration, the new children receive one porperty from one parent or another.</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/Captura-de-pantalla-de-2020-03-28-02-04-11.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-04-11-2xl.png 1600w\"  alt=\"\" width=\"676\" height=\"708\"></figure>\n<p class=\"align-center\"><strong>Mutation method</strong> </p>\n<h3 id=\"mcetoc_1e4fb64sj1\">Fitting function</h3>\n<p id=\"mcetoc_1e4fci7842\">To understand optimization algorithms, we first need to understand the concept of minimization. Maximization is a similar concept to optimization - let's say we have a simple equation y = x2 - the idea is we're trying to figure out what value of x will maximize y, in this example Infinite. This idea of a maximixer will allow us to build an optimizer.</p>\n<p>In our case we're trying to find a portfolio that maximizes the Sharpe Ratio. To achieve the goal of maximizes the Sharpe Ratio function we must create some functions that will generate the expected portfolio performance, performance weights, and the standard deviation of the portfolio, sharpe ratio and many random portfolios.</p>\n<p class=\"align-left\">First, In order to simulate thousands of possible allocations for our simulation we'll be using a few statistics, one of which is mean daily return. For this we're going to switch to using logarithmic returns instead of arithmetic returns. In the world of finance, the arithmetic mean is not usually an appropriate method for calculating an <a href=\"https://www.investopedia.com/ask/answers/06/geometricmean.asp\">average</a>.</p>\n<p>Then, into <em>__shrape</em> function we calculate return, volatility, and the Sharpe Ratio as of the logarithmic mean. Also, the method has one param, that are the weight of every component of the portfolio generated on the current iteration</p>\n<p class=\"align-center\"> </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/Captura-de-pantalla-de-2020-03-28-02-20-08.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-20-08-2xl.png 1600w\"  alt=\"\" width=\"581\" height=\"484\"></figure>\n<p class=\"align-center\"><strong>Fitness method</strong> </p>\n<h3 id=\"mcetoc_1e4fcn20s0\">Early stop</h3>\n<p>When you are solving a problems without know te results, one of the problems are that you are not know when te algorithm has finished. For this, I have develop a param into main function to detect if during the last 'stop_rounds' generations the difference<br> absolute among better individuals is not higher than the value of  'stop_tolerance', the algorithm is stopped. The 'stop_rounds' is  the number of consecutive generations with no minimum improvement to activate the early stop. And the 'stop_tolerance' is the minimum value that must have the difference of consecutive generations to consider that there is change</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/Captura-de-pantalla-de-2020-03-28-02-42-29.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-02-42-29-2xl.png 1600w\"  alt=\"\" width=\"501\" height=\"461\"></figure>\n<p id=\"mcetoc_1e4fcn20s0\" class=\"align-center\"><strong>Early stop method</strong><span style=\"font-size: inherit;\"> </span></p>\n<h2 id=\"mcetoc_1e4fd036u0\">Case studies</h2>\n<p>As output of the genetic algorithm can be visualized for each generation, which has been the best combination along with the list of the best weights. We select an investment portfolio formed by Cellnex Telecom, S.A.(MTS.MC) , ArcelorMittal (MTS.MC), Ferrovial, S.A. (FER.MC) and Banco Santander, S.A. (SAN.MC).</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/22.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/22-2xl.png 1600w\"  width=\"1044\" height=\"794\"></figure>\n<p class=\"align-center\"><strong>Daily prices of the companies for 1 year</strong></p>\n<p>If we select an investment portfolio formed by Cellnex Telecom, S.A.(MTS.MC) , ArcelorMittal (MTS.MC), Ferrovial, S.A. (FER.MC) and Banco Santander, S.A. (SAN.MC). The results are as follows: 0% Telecom and 0,1% ArcelorMittal, 0% Ferrovial and 99% Banco Santander . If we look at the allocations, it makes perfect sense since the strongest company is Santander and it has a much higher return than the rest and therefore should be given more weight to investment. On the other hand, the companies with a negative average are assigned less than 1% of the total weightof the portfolio. </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/Captura-de-pantalla-de-2020-03-28-18-45-24.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/Captura-de-pantalla-de-2020-03-28-18-45-24-2xl.png 1600w\"  alt=\"\" width=\"835\" height=\"204\"></figure>\n<p class=\"align-center\"><strong>Output generate for the software</strong></p>\n<p class=\"align-center\"> </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/indice.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/responsive/indice-2xl.png 1600w\"  alt=\"\" width=\"418\" height=\"262\"></figure>\n<p class=\"align-center\"><strong>Ratio value for every portofolio</strong></p>\n<blockquote>\n<p>Needless to say, this is not an invitation to buy and sell assets.</p>\n<div class=\"post__iframe\"><iframe loading=\"lazy\" width=\"480\" height=\"270\" src=\"https://giphy.com/embed/j3WGZFgTGYKTPH3NtM\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen=\"allowfullscreen\" data-mce-fragment=\"1\"></iframe></div>\n<p><a href=\"https://giphy.com/gifs/MovistarPlus-business-take-my-money-la-resistencia-j3WGZFgTGYKTPH3NtM\">via GIPHY</a></p>\n</blockquote>\n<h2 id=\"mcetoc_1e44o9k7t0\">Bibliography</h2>\n<ol>\n<li>Rodríguez, M. P., Cortez, K. A., Méndez, A. B. y Garza, H. H. (2015). Análisis de portafolios por sectores mediante el uso de algoritmos genéticos: caso aplicado a la Bolsa Mexicana de Valores. Contaduría y Administración, 60(1), 87-112.</li>\n<li>Castro Enciso S. Fernando, “Creación de Portafolios de Inversión utilizando Algoritmos Evolutivos Multiobjetivo”, Tesis de Licenciatura, Centro de Investigación y Estudios Avanzados del Instituto Politécnico Nacional, México, D.F, (2005).</li>\n</ol>\n<p><a href=\"https://github.com/jaumeCloquellCapo/portfolio-optimizer\">Github</a></p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/17/indice.jpeg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Machine Learning",
                   "Genetic Algorithms"
            ],
            "date_published": "2020-03-28T01:28:15+01:00",
            "date_modified": "2020-03-29T17:28:49+02:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/introduccion-a-los-algoritmos-geneticos.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/introduccion-a-los-algoritmos-geneticos.html",
            "title": "Introduction to Genetic Algorithms",
            "summary": "The genetic algorithm simulates biological evolution in which organisms adapt to their environment by repeating mutation, crossover and selection for many generations. It is commonly used to find optimal solutions and applied to various problems, such as the low-air-resistance “Aero Double Wing” design of bullet&hellip;",
            "content_html": "<p>The genetic algorithm simulates biological evolution in which organisms adapt to their environment by repeating mutation, crossover and selection for many generations. It is commonly used to <span class=\"thisblog_yellow firstChild lastChild\"><strong class=\"firstChild lastChild\">find optimal solutions</strong></span> and applied to various problems, such as the low-air-resistance “Aero Double Wing” design of bullet trains.</p>\n<p>The algorithm begins by initializing <strong>a population of individuals</strong> using default or random values. Then, it runs each member of that population through a fitness function. It selects the fittest members of the population to reproduce using a method defined in the <strong>reproduction function</strong>, then repeats the evaluation and reproduction until a desired number of iterations have passed. At termination, the algorithm presents the best member or members of the population according to the fitness function. Let's discuss each of these concepts further. To explain this post we will apply a genetic algorithm that reproduces the text \"hellow world\".</p>\n<h3>Genetic Algorithm Basics</h3>\n<p>Each individual in the population must be represented by a value or object, which must be stored in a data structure. A basic example is each individual being a tuple of values and the population is a list of such tuples. An individual can also be an object or class, with whatever attributes and methods you implement. The population data structure may also place constraints upon the simulation, for example, the distance between two individuals in a list or two-dimensional array may be important in some functions.</p>\n<ol>\n<li><strong>[Start] </strong>Generate random population of <i>n</i> chromosomes (suitable solutions for the problem)</li>\n<li><strong>[Fitness]</strong> Evaluate the fitness <i>f(x) </i>of each chromosome <i>x</i> in the population</li>\n<li><strong>[New population] </strong>Create a new population by repeating following steps until the new population is complete\n<ol>\n<li><strong>[Selection] </strong>Select two parent chromosomes from a population according to their fitness (the better fitness, the bigger chance to be selected)</li>\n<li><strong>[Crossover]</strong> With a crossover probability cross over the parents to form a new offspring (children). If no crossover was performed, offspring is an exact copy of parents.</li>\n<li><strong>[Mutation]</strong> With a mutation probability mutate new offspring at each locus (position in chromosome).</li>\n<li><strong>[Accepting]</strong> Place new offspring in a new population</li>\n</ol>\n</li>\n<li><strong>[Replace]</strong> Use new generated population for a further run of algorithm</li>\n<li><strong>[Test]</strong> If the end condition is satisfied, <strong>stop</strong>, and return the best solution in current population</li>\n<li><strong>[Loop]</strong> Go to step <strong>2</strong></li>\n</ol>\n<h3 id=\"fitness-function\">Fitness Function</h3>\n<p>The <strong>fitness function</strong> is the heart of a genetic algorithm. The function takes an individual and determines how well it fulfills whatever criteria the algorithm is optimizing for. </p>\n<p>The fitness function should be applied to each individual of the population separately to determine whether they should be allowed to reproduce. The function may return a fitness score or a boolean for whether the individual passes a set threshold for reproduction.</p>\n<p>In this case, we might define a cost function to be something like the following:</p>\n<blockquote>For each character in the string, figure out the difference in ASCII representation between the candidate character and the target character, and then square it so that the \"cost\" is always positive.</blockquote>\n<p>For example, if we have a capital \"A\" (ASCII 65) but it's supposed to be a capital \"C\" (ASCII 67), then our cost for that character is 4 (67 - 65 = 2, and 2^2 = 4).</p>\n<p>Using that rule as a cost function, we can calculate the costs of the above 5 example chromosomes (in parentheses):</p>\n<ul>\n<li class=\"align-center\"><code>Gekmo+ xosmd <strong>(7)</strong></code></li>\n<li class=\"align-center\"><code>Gekln, worle\" <strong>(5)</strong></code></li>\n<li class=\"align-center\"><code>Fello, wosld <strong>(5)</strong></code></li>\n<li class=\"align-center\"><code>Gello, wprld <strong>(2)</strong></code></li>\n<li class=\"align-center\"><code>Hello, world <strong>(0)</strong></code></li>\n</ul>\n<h3 id=\"selection-function\">Selection Function</h3>\n<p>The <strong>selection function</strong> takes the population and the results of the fitness function to determine who should reproduce. If the fitness function had a set threshold for reproduction and returned a boolean, then the selection function simply filters the population by that value. However, if the fitness function returned raw scores, the selection function calculates a threshold from those scores. For example, it may calculate the average score and only keep the top half of the population. It passes the selected population into the reproduction function and deletes the rejected individuals.</p>\n<h3 id=\"reproduction-function\">Reproduction Function</h3>\n<p>The <strong>reproduction function</strong> determines how to expand the population based on the existing members. Modifying the behavior and hyperparameters of the reproduction function is one of the most complex and impactful parts of creating a genetic algorithm, as the reproduction function is what determines how the population changes over time.</p>\n<p>The simplest reproduction method is <strong>mutation</strong>, where each new member is based on a single individual. If you are doubling the population by mutation, for each individual create a new individual with the same characteristics modified by a random factor.</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://media.geeksforgeeks.org/wp-content/uploads/genetic-algorithm2.png\" data-is-external-image=\"true\"  width=\"366\" height=\"149\"></figure>\n<p>Here's an example to illustrate. Let's say you end up with these two chromosomes:</p>\n<p class=\"align-center\"><code>Hfllp, worlb</code><br><code> Hfllp, worlb</code></p>\n<p>Your two chromosomes are exactly the same. That means that their children will be exactly the same as the parents, and no progress will ever be made. But if 1 in 100 chromosomes has one letter randomly mutated, it's only a matter of time before chromosome #2 above turns into \"Ifllp, worlb!\" -- and then the evolution continues because the children will finally be different from the parents once again. Mutation pushes the evolution forward.</p>\n<p><strong>Crossover</strong> is a more complex method of reproduction, where each new individual is based on some combination of existing individuals. Crossover still mutates the new organism’s attributes, but does so by applying a function of multiple organisms’ attributes. These two approaches can simulate asexual and sexual reproduction, respectively, and both include random factors to advance the population as a whole and model the role of chance in real-world evolution. The reproduction function returns the new population, which may be the same size or a different size than the original population.</p>\n<p> </p>\n<center><figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://media.geeksforgeeks.org/wp-content/uploads/genetic-algorithm1.png\" data-is-external-image=\"true\"  alt=\"https://media.geeksforgeeks.org/wp-content/uploads/genetic-algorithm1.png\" width=\"696\" height=\"149\"></figure> </center>\n<p>With our example, you can pick two candidates (two strings; two chromosome) and pick a point in the middle of the string. This point can be dead-center if you want, or randomized if you prefer. Take that middle point (called a \"pivot\" point), and make two new chromosomes by combining the first half of one with the second half of the other and vice versa.<br><br>Take these two strings for example:</p>\n<p class=\"align-center\"><code>Hello, wprld (1)</code><br><code> Iello, world (1)</code></p>\n<p>Cutting them in half and making two new strings from the alternating halves gives us these two new \"children\":<br><code></code></p>\n<p class=\"align-center\"><code>Iello, wprld (2)</code><br><code> Hello, world (0)</code></p>\n<p>As you can see, the offspring includes one bad child that has the worst traits of both parents, but also an good child that has the best traits of both.<br><br>Mating is how you get from one generation of genes to the next.</p>\n<h3 id=\"termination-function\"><strong>Termination</strong> Function</h3>\n<p>After the desired iterations have occurred, the <strong>termination function</strong> takes the ending population and returns the best members by fitness score. The role of the termination function depends entirely on the application. For a video game, the termination function might output optimal statistics for the final boss, for a mathematical optimization, it returns the best input values to the function.</p>\n<p>Now, we will consider these functions in action by implementing and evaluating a genetic algorithms.</p>\n<h2 id=\"geneticsalgorithmsinr\">Genetics Algorithms in Python!</h2>\n<p>My intention is to provide you with a clean code so you can understand what's behind, while at the same time, try new approaches like modifying the fitness function.</p>\n<p>Clone the <a href=\"https://github.com/jaumeCloquellCapo/Genetic-Algorithms\" target=\"_blank\" rel=\"noopener noreferrer\">github repository</a> to run the example.</p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/Captura-de-pantalla-de-2020-03-24-22-48-43.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-48-43-2xl.png 1600w\"  alt=\"\" width=\"810\" height=\"312\"></figure>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/Captura-de-pantalla-de-2020-03-24-22-54-41.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-54-41-2xl.png 1600w\"  alt=\"\" width=\"707\" height=\"884\"></figure>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/Captura-de-pantalla-de-2020-03-24-22-55-06.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/responsive/Captura-de-pantalla-de-2020-03-24-22-55-06-2xl.png 1600w\"  alt=\"\" width=\"709\" height=\"277\"></figure>\n<p>As output of the genetic algorithm can be visualized for each generation, which has been the best combination along with the percentage of success with respect to the final goal, write the phrase \"hellowwrold\"</p>\n<pre>Generation: 27<br>Average fitness: 89.15%<br>Genomas: hellowwcrld<br>Generation: 28<br>Average fitness: 90.18%<br>Genomas: hellowwcrld<br>Generation: 29<br>Average fitness: 89.93%<br>Genomas: hellowwcrld<br>Generation: 30<br>Average fitness: 89.98%<br>Genomas: hellowwcrld<br>Generation: 31<br>Average fitness: 90.16%<br>Genomas: hellowworld</pre>\n<p> </p>\n<p> </p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/16/1ipQ8V22JyL9kIAeTDrv0yA.jpeg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Machine Learning",
                   "Genetic Algorithms"
            ],
            "date_published": "2020-03-24T21:44:00+01:00",
            "date_modified": "2020-03-25T00:02:45+01:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/analisis-de-una-nueva-estrategia-seleccion-de-consumidores-semillas-para-el-lanzamiento-de-nuevos-productos-el-papel-de-los-hubs-mas-cercanos-al-producto.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/analisis-de-una-nueva-estrategia-seleccion-de-consumidores-semillas-para-el-lanzamiento-de-nuevos-productos-el-papel-de-los-hubs-mas-cercanos-al-producto.html",
            "title": "Análisis de una nueva estrategia selección de consumidores semillas para el lanzamiento de nuevos productos: El papel de los hubs más cercanos al producto",
            "summary": " Cuando se lanza un nuevo producto, las empresas suelen regalar muestras gratuitas para dar a conocer el producto en el mercado. Uno de los problemas fundamentales en el marketing viral es encontrar un pequeño conjunto de consumidores semilla que puedan desencadenar la mayor cantidad de&hellip;",
            "content_html": "<h2> </h2>\n<p>Cuando se lanza un nuevo producto, las empresas suelen regalar muestras gratuitas para dar a conocer el producto en el mercado. Uno de los problemas fundamentales en el marketing viral es encontrar un pequeño conjunto de consumidores semilla que puedan desencadenar la mayor cantidad de adopciones a través de la propagación de influencias de boca en boca (WOM) en la red. <br><br>Utilizando modelos basados en agentes ( en adelante ABM ) y basándonos en los estudios que demuestran que la difusión es más rápida cuando participan personas con mayor conectividad proponemos un nuevo método de selección de consumidores semilla basada en la combinación entre hubs y los agentes más cercanos al producto. Posteriormente compararemos el método de selección propuesto con el resto de métodos de selección de consumidores semilla (aleatorio, hub y agentes más cercanos al producto) para obtener una respuesta óptima de qué consumidores semilla y cuantos de estos generan mayor difusión del producto con el objetivo de aumentar los ingresos de las campañas de marketing viral y al mismo tiempo reducir los costos.</p>\n<h2>Modelo de simulación en marketing basado en agentes</h2>\n<p>Dentro de la difusión social de productos se encontró otra perspectiva y<br>es la que tradicionalmente se ha utilizado para realizar estrategias de mer-<br>cadeo. Esta estrategia se enfoca en los hubs, las personas que poseen en su<br>red social una gran cantidad de contactos. Existen investigaciones que han<br>establecido diferentes estrategias para través de ellos incrementarı́a el efecto<br>WOM, pero aún no existe un consenso de cuál serı́a la mejor. Janssen [28],<br>cree que la difusión de innovaciones está altamente influenciada por los hubs.</p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/wom.jpeg\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-xs.jpeg 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-sm.jpeg 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-md.jpeg 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-lg.jpeg 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-xl.jpeg 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/wom-2xl.jpeg 1600w\"  alt=\"\" width=\"2048\" height=\"960\"></figure><br><br>En este proyecto, se hará uso de un modelo de comportamiento de consumidor desarrollado por Janssen [13] y que representará una base sólida sobre la que desarrollar posteriores puntos del trabajo. Se trata de un modelo que simula la compra del número de N consumidores respecto a M productos durante un periodo de tiempo determinado usando un time step diario. La salida del modelo consiste en el número de compradores para cada paso de la simulación.</p>\n<p>Los agentes representan usuarios básicos o influentials del total de usuarios de la aplicación, dependiendo del ratio inicial de usuarios influentials sobre el total de usuarios. Tienen un conocimiento limitado de las opiniones, compras y decisiones que se dan durante la ejecución del modelo. Durante la inicialización del modelo, cada agente es inicializado como usuario básico o influentials, aleatoriamente. Debido a la aleatoriedad del modelo cada ejecución puede resultar en distintos patrones de difusión y resultados finales, por lo que usamos simulaciones de Monte-Carlo (MC) y ejecutamos múltiples veces la simulación. Cada agente toma decisiones sı́ncronamente [6].<br><br>Los agentes tienen una variable para representar cuando un usuario ha comprado un producto junto con una variable de estado que representa si se trata de un \"influentials\", o no. Cada agente tiene un conjunto de enlaces que representan las relaciones sociales entre usuarios de la aplicación. Estas relaciones son enlaces bidireccionales que habilitan el intercambio de información y canalizan influencias entre ellos.<br><br>En cada paso del modelo, cada agente primero decide si actuar ese dı́a (a partir de ahora lo llamaremos jugar) o no siguiendo una probabilidad que depende del dı́a de la semana [6]. Modelamos este comportamiento usando dos parámetros:</p>\n<ul>\n<li>La probabilidad de jugar entre semana ($d \\in [0,1]$)</li>\n<li>La probabilidad de jugar en fin de semana ($f \\in [0,1]$</li>\n</ul>\n<p>Si un agente juega a la aplicación, podrá decidir posteriormente si comprar o no un producto en base a los umbrales de incertidumbre y utilidad. La probabilidad de jugar de cada agente sigue la ecuación de abajo.El agente A decide jugar el día si la función jugar (r) devuelve 1, donde ∈[0,1) es un número aleatorio generado usando una distribución uniforme.</p>\n<p class=\"align-center\"><br>\\begin{equation}<br> \\label{eqn:playtoday}<br> jugar_{r}^{t}(r)=\\begin{cases}1,&amp; si &lt;  d \\wedge t \\in entre -semana \\\\1, &amp; si &lt;  d \\wedge t \\in fin -semana \\end{cases}<br>\\end{equation}</p>\n<p><br>Para dotar de un comportamiento de consumidor a los agentes del modelo, Janssen define unas reglas de comportamiento que se resumen en la siguiente sección</p>\n<h2>Proceso de Decisión de Compra</h2>\n<p><br>El proceso de decisión de compra del consumidor es aquel proceso cognitivo mediante el cual se hace una elección a partir de múltiples alternativas [17], teniendo en cuenta tanto factores individuales como sociales para deliberar. La parte individual expresa la diferencia entre las preferencias personales de los consumidores para cada producto del modelo y las propiedades de dicho modelo (que pueden estar expresadas como un conjunto de características). Modelamos estas características mediante una sola variable $ d_{j} $ . Los consumidores tienen una preferencia personal $ \\pi_{j} $  acerca de sus necesidades en el mercado.</p>\n<p class=\"align-center\"><br>$d_{j}\\in[0,1], \\forall j \\in J$<br><br>$\\pi_{j}\\in[0,1], \\forall \\in I$</p>\n<p><br>La utilidad de un producto, basada sólo en la preferencia personal, es igual a 1 menos la diferencia en valor absoluto entre la preferencia personal de un agente hacia un producto $\\pi_{i}$ y la dimensión de dicho producto $d_{i}$. Por tanto, si las características del producto son iguales a las preferencias del consumidor ( c = p ), el consumidor podrá seleccionar el producto con una alta probabilidad:</p>\n<p class=\"align-center\">$\\mu_{ij} = (1-|d_{j}-\\pi_{i}|)$ </p>\n<p><br>De otra parte, el efecto social que condiciona la decisión, considera las diferentes relaciones (o conexiones) que se dan en las redes sociales de los individuos y que, influyen en su estado y personalidad [3]).El modelo para simular la toma de decisiones del consumidor propuesto por Janssen [28], considera tanto los efectos individuales como los sociales, teniendo en cuenta dos variables principales: la satisfacción y la incertidumbre.<br><br>La satisfacción (E[Uij ]) hace referencia al nivel de placer del consumidor i cuando usa el producto j, e incluye la parte individual y social:</p>\n<p class=\"align-center\">$E[Uij] = (1-\\beta_{i})*(1-|dj-\\pi_{i}|)+\\beta_{\\gamma^{t}_{ij}}$</p>\n<p><br>La parte individual considera tanto las preferencias de los consumidores i ( $p_{i}$) como las características del producto j ($c_{j}$ ). La parte social, se refiere al segmento de contactos del consumidor (i) que consumen el producto (j) ( $ \\gamma^{t}_{\\neq x_{i}^{t - 1}} $ ).<br><br>Ambos componentes (individual y social) se ponderan por $\\beta_{i}$ y ($1 - \\beta_{i}$) respectivamente. La variable $\\beta_{i}$ expresa la sensibilidad de un cliente (i) de adquirir un producto diferente al de sus contactos. Por tanto, a partir de un alto $\\beta_{i}$, se intuye un cliente innovador, poco dependiente del criterio social, tal como se discute en el contexto del proceso de difusión social [4].<br><br>La incertidumbre (E[Uncij ]) , representa la inseguridad del consumidor para tomar una decisión. Así, por ejemplo, entre mayor sea el número de contactos del consumidor i que están comprando productos diferentes, la incertidumbre es mayor. Por lo tanto, la incertidumbre representa la fracción de contactos que están comprando un producto distinto al del consumidor i ($ 1-\\gamma^{t}_{\\neq x_{i}^{t - 1}} $) ponderado por la importancia de la necesidad social ($\\beta_{i}$).<br><br>En este sentido, si las necesidades sociales son mayores, la incertidumbre tiende a ser alta siempre que los contactos estén comprando productos diferentes.</p>\n<p class=\"align-center\">$E[Unc_{ij}] = \\beta_{i}*(1-\\gamma^{t}_{\\neq x_{i}^{t - 1}})$</p>\n<br>Los agentes pueden tomar diferentes decisiones dependiendo de su nivel de satisfacción e incertidumbre. Los umbrales que controlan estos comportamientos son Umin (el nivel mínimo de satisfacción) y Unct (el nivel de tolerancia a la incertidumbre), ambos estáticos para cada agente durante la simulación. Cuando todos los agentes han tomado sus decisiones se actualizan los niveles de incertidumbre y satisfacción esperada. De esta forma, podemos distinguir entre el umbral esperado, que hace referencia a lo que los agentes experimentan mientras consumen un producto que está siendo comprado en su entorno, y el experimentado, que es fijo para cada agente. Las siguientes cuatro heurísticas representan las acciones de los agentes y utilizan los umbrales mencionados anteriormente: <br><br>\n<ul>\n<li> Repetición (agente satisfecho y convencido de su elección [$U_{i}$ $≥$ Umin $|$ $Unct_{i}$ $≤&lt;$ Unct]): los agentes siguen comprando el producto que compraron en su última compra:</li>\n</ul>\n<p class=\"align-center\"><br> \\begin{equation}<br>\\label{equ:repetition}<br> x_{i}^{t} = x_{i}^{t - 1}<br>\\end{equation}</p>\n<ul>\n<li>Deliberación (agentes no satisfechos pero convencidos de su elección [$U_{i}$ $&lt;$ Umin $|$ $Unct_{i}$ $≤$ Unct]): los agentes comprueban cuál es la utilidad ($u_{ij}^{t}$) esperada de adquirir cada producto y utilizan la siguiente función logística para elegir su nueva compra:</li>\n</ul>\n<p class=\"align-center\"><br> \\begin{equation}<br>\\label{equ:deliberation}<br> prob_{i}^{t}(j) = \\frac{e^{u_{ij}^{t}}}{\\sum_{k \\in J_{i}^{t}}e^{u_{ik}^{t}}}, \\forall j \\in J_{i}^{t}<br>\\end{equation}</p>\n<ul>\n<li>Imitación (agentes satisfechos pero no convencidos de su elección [$U_{i}$ $≥$ Umin $|$ $Unct_{i}$ $&gt;$ Unct]): los agentes evalúan los productos que están siendo consumidos por su entorno. Aquellos productos (j) consumidos por un mayor número de contactos serán más propensos a ser escogidos en la siguiente toma de decisiones:</li>\n</ul>\n<p class=\"align-center\">\\begin{equation}<br>\\label{equ:imitacion}<br> prob_{i}^{t}(j) = \\frac{e^{2_{\\gamma^{t - 1}_{ij}}}}{\\sum_{k \\in J_{i}^{t}}e^{2_{\\gamma^{t - 1}_{ij}}}}, \\forall j \\in J_{i}^{t}<br>\\end{equation}</p>\n<p> </p>\n<ul>\n<li>Comparación Social (agentes insatisfechos y no convencidos de su elección [$U_{i}$ $&lt;$ Umin $|$ $Unct_{i}$ $&gt;$ Unct]): los agentes evalúan los productos consumidos en su entorno sin tener en cuenta aquellos que no han sido consumidos ($J′\\subset J_{i}^{t}$) por lo que el conjunto de posibles decisiones se reduce.</li>\n</ul>\n<p class=\"align-center\"><br>$prob_{i}^{t}(j) = \\frac{e^{u^{t}_{ij}}}{\\sum_{k \\in J`_{i}^{t}}e^{u^{t}_{ij}}}, \\forall j \\in J`_{i}^{t}$<br><br></p>\n<p> </p>\n<p>En resumen, los clientes cuya satisfacción es alta mientras sus niveles de incertidumbre son bajos, tienden a repetir la última compra. Sin embargo, en caso contrario, cuando la satisfacción es baja y la incertidumbre es alta, la decisión del consumidor dependerá de la comparación social, en la cual se escoge el mejor producto entre los contactos. De otra parte, cuando los clientes tienen bajos niveles de satisfacción e incertidumbre, se encuentran en una situación de deliberación y, en consecuencia, evaluarán el impacto de todas las decisiones posibles para maximizar su nivel de satisfacción según sus expectativas. Finalmente, los clientes que tienen un alto grado de incertidumbre y satisfacción, se enfrentan a un proceso de imitación, replicando el comportamiento de compra de sus amigos, es decir, el producto más popular entre ellos.</p>\n<h2>Conocimiento y difusión</h2>\n<p>Para el intercambio de conocimiento en el modelo utilizamos un mecanismo basado en<br>probabilidades con el que modelamos la velocidad para el intercambio de conocimientos y para el olvido de opiniones. De esta manera, a continuación, definimos las variables probabilidad de difusión y olvido de conocimientos.</p>\n<h3>Probabilidad de difusión</h3>\n<p>En primer lugar el modelo tiene una probabilidad de difusión de la conciencia $p_{0}\\in[0,1]$ que permite al agente de consumo hablar sobre el producto cuando es consciente de ello. Para determinar si un consumidor habla de un producto, se genera un número aleatorio en [0,1]. Si este número no excede el valor de $p_{0}$, el agente difundirá su conocimiento sobre el producto a sus contactos directos y estos contactos también serán conscientes del producto.</p>\n<h3>Olvido de conocimientos</h3>\n<p>El modelo también incorpora un comportamiento de sensibilización del consumidor [24] para que los agentes tengan un conocimiento limitado sobre el conjunto de productos disponibles en el mercado, basándonos el ideal de racionalidad humana limitada [5]. Para cada producto, se define un valor $d \\in[0,1]$ de olvido. Si este valor no excede el umbral fijado por ($D_{p}$) , el agente i olvidará la información obtenida en la etapa de adquisición de conocimientos sobre el producto j. De otra forma, el agente continuará teniendo conocimiento sobre dicho producto y podrá formar parte del conjunto final con el que tomará sus decisiones de compra. Altos valores de ($D_{p}$) hacen que los agentes tiendan a olvidar la información obtenida en procesos de difusión mientras que bajos valores de esta variable impiden que se pierda información con facilidad</p>\n<h2>Estrategia de selección de consumidores semilla</h2>\n<p>Cuando un nuevo producto, que no es conocido por los consumidores, entra en el mercado, la empresa adopta algunas estrategias de comercialización para presentarlo a los consumidores potenciales, y la práctica más común es la publicidad.<br><br>Con la proliferación de la publicidad, los consumidores dan menos valor a la información del marketing que a la de sus amigos [14]. Por lo tanto, las empresas llevan a cabo programas de \"product seedin\", en los que los nuevos productos se distribuyen gratuitamente a una parte seleccionada de consumidores potenciales ( \"influentials\" ) antes de su lanzamiento, y esperan que estos consumidores puedan expresar a sus conexiones cercanas una opinión positiva sobre el nuevo producto. Por lo tanto, a través de los programas de difusión de nuevos productos, una parte de los consumidores potenciales de la red social puede recibir información (WOM) sobre el nuevo producto de sus amigos en una etapa temprana de su lanzamiento. Parte de ellos adoptan el nuevo producto y se convierten en nuevos emisores de WOM a la red social. De esta manera, se acortar el tiempo de generación de un número masivo de consumidores, que pueden contribuir eficazmente al proceso de difusión del nuevo producto y por tanto en el número de ventas. Generalmente, se hace uso de la aleatoriedad o se seleccionan los consumidores potenciales en función de dos características, que son la posición en la red social y la propensión a adoptar.</p>\n<h3>Estrategia de selección de consumidores semilla aleatorio</h3>\n<p>La opción más sencilla para la selección de consumidores semilla que consiste en elegir un nodo al azar. La razón para esto es la siguiente: si bien cuando elegimos un nodo al azar, la probabilidad de que este sea un \"hub\" es muy pequeña, la probabilidad de que eligiendo uno de sus vecinos al azar tengamos un \"hub\" es mucho mayor. Esto es debido a la alta conectividad de los \"hub\", que hace que la probabilidad de que un nodo esté conectado con uno de ellos es mucho mayor que para el resto.</p>\n<h3>Estrategia de selección de consumidores semilla mediante hubs</h3>\n<p>Como se mencionó en la sección <a href=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/sistemas-complejos-y-redes-sociales.html\">redes Artificales</a>, una de las características de las redes sociales es la existencia de ciertos nodos, los denominados \"hubs\", cuya conectividad es muy superior a la media. Se llega inmediatamente a la conclusión de que en el caso de que en estos nodos se encuentre un consumidor semilla, su acción sobre la red se verá notablemente potenciada [8].<br><br>Regalar los productos a los denominados \"hubs\" tiene la ventaja de exponer los nuevos productos a un gran número de consumidores potenciales en un corto período de tiempo. Puede parecer que la opción más sencilla sería aumentar el número de estos sujetos, sin embargo esta técnica ha dejado de lado los criterios de aceptación de los consumidores a la hora de comprar un producto, es decir sus preferencias respecto al producto. En distintas condiciones de mercado y de producto, el rendimiento de los consumidores semilla en distintos objetivos cambiaría, especialmente en lo que respecta al nivel de sofisticación, la desviación media y estándar de las preferencias de los consumidores que puede afectar al objetivo final de optimizar el número de consumidores semilla</p>\n<h3>Estrategia de selección de consumidores semilla cercanos al producto</h3>\n<p>El problema de hacer uso de los \"hubs\" es que pueden no hacer uso pleno de sus conexiones [1]. Por lo tanto, otra estrategia consiste en focalizar el uso consumidores semilla con alta propensión a adoptar el producto. Esto enfoque ayuda a acelerar todo el proceso de difusión y a mejorar la propagación de la WOM en las primeras etapas [16]. Los consumidores tempranos tienen la capacidad de aceptar pérdidas financieras cuando la innovación no satisface sus necesidades [10].Si seleccionamos a los consumidores cuya utilidad sea máxima con el producto, los procesos iniciados en estos agentes se propagaran rápidamente ya que dichos nodos difundirán opiniones positivas respecto al producto.</p>\n<h3>Nueva estrategia de selección consumidores semilla mixta entre hubs y consumidores cercanos al producto</h3>\n<p>En base a los estudios anteriores, llegamos a la conclusión que si solo nos basáramos en tener en cuenta el número de conexiones, podríamos generar insatisfacción entre nuestros clientes en el caso que el producto no cumpliera con los objetivos de los consumidores. Si la actitud de los consumidores es negativa, el consumidor puede tomar una o más de tres acciones: rechazar el producto para comprar otro, quejarse a la empresa y difundir el producto negativo entre los consumidores [15]. Por otro lado, si nuestra estrategia se basara en asegurarnos el cumplimiento de utilidad del producto seleccionando aquella consumidores fieles a nuestro producto, estaríamos dejando al lado a un gran número de potenciales consumidores por le simple hecho de que la mayoría de casos no llegarían a conocer el producto por la falta de conexiones que tendrían nuestros consumidores semilla respecto al resto de la población. <br><br>Para evitar este efecto negativo al proceso de difusión definimos una estrategia de selección de consumidores semilla los cuales no solos son considerados los \"hubs\" sino que entre todos los \"hubs\" que haya dentro de la red social seleccionamos aquellos que tengan unas preferencias cercanas a las propiedades del producto con el objetivo de reducir al máximo el rechazo o la insatisfacción de los nuevos consumidores.<br><br> Para llevar a cabo esta estrategia mixta de selección de consumidores semilla, por cada agente se debe calcular el número de conexiones y la utilidad respecto al producto a regalar. Una vez tenemos estos valores, generamos dos lista ordenadas de agentes, una por grado y la otra por utilidad, y el resultado final consiste en encontrar aquellos agentes que se encuentren en las posiciones más altas en las dos listas.<br><br> Posteriormente, se hace un sumatorio de la posición en la lista ordenada de grado junto con la posición de la lista ordenada por utilidad. Aquellos agentes con mayor valor, serán los elegidos como consumidores semilla.</p>\n<h2>Verificación y validación del modelo </h2>\n<p> La verificación se realiza para comprobar la correspondencia entre el modelo operacional implementado  y  el  modelo  conceptual.  Lo  anterior,  puede  hacerse  por  medio  de  la  programación pragmática y el test de casos y escenarios. La programación pragmática busca  asegurar  que  el modelo  realmente  haga  lo  que  el  programador  cree  que  hace .  En  el  modelo  propuesto  se  prueba  la  programación  pragmática mediante  pruebas  unitarias  y  de  depuración  donde  paso  a  paso  se  examinaron  los resultados  esperados  en  cada  una  de  sus  fases  (inicialización  e  interacción  entre agentes). Se realizó  seguimiento  a  la  evolución  de  las  propiedades y  mecanismos  de activación  de  los  agentes  para asegurar que  el código  estaba generando  el resultado esperado,  así  como  la  observación  de  gráficas  e  indicadores.  Adicionalmente,  se realizaron pruebas de código ver-sus modelo conceptual para determinar si sus lógicas coincidían y se anularon rutinas clave para evaluar comportamientos anormales.</p>\n<p> Para la verificación del modelo se testearon los resultados del modelo ante condiciones extremas de los parámetros y sin la aplicación de consumidores semillas para facilitar la compresión del modelo. Así, se examinó el comportamiento del modelo analizando la cantidad promedio de ventas y el uso de la heurísticas. <br> <br>Se empezó a testear el modelo sobre una red aleatoria de 1024 agentes con probabilidad de enlace de 0.01 que da a la red un grado medio final de 10 conexiones por agente. Se llevaron a cabo 5 pruebas con diferentes valores de entrada y se verificó que los valores de salida estuvieran dentro de los rangos lógicos en los cuales esas variables deberían de estar. Con todo esto, se comprobó que el modelo presentaba unos resultados predecibles. </p>\n<p>Para hacer un modelo de consumo difusión realista los agentes tendrán ciertas limitaciones tanto a la hora de difundir sus conocimientos como a la hora de obtenerlos mediante la probabilidad de difusión, que permitirá a un agente compartir parte de sus conocimientos en su red de contactos, y el awareness decay, que mide la probabilidad de que los agentes olviden parte de la información que tenı́an sobre los productos del mercado.</p>\n<p>Finalmente para tener en cuenta las preferencias heterogéneas de los consumidores, utilizamos los datos conjuntos a nivel individual para construir una función de utilidad lineal por partes para cada uno de los 4 atributos del producto para cada agente consumidor y parametrizar los agentes en consecuencia. Para diversificar el mercado de producto, se han definido dos productos muy alejados de las preferencias de los usuarios, el producto 0 y 5 otros dos productos más cercanos a las preferencias de los consumidores, el producto 1, 4 y finalmente los más cercanos que son el producto 2 y 3. Nuestro objetivo es incrementar la ventas del producto 4, un marca que no es la más cercana a las preferencias del mercado pero que no es considerada la peor de todas.</p>\n<p>A continuación, se presentan las curvas de difusión media obtenidas de cada comportamiento ara cada tipo de prueba para cada escenario. Debido a que la comparación visual de ellas no es suficiente para establecer diferencia, se calcularon tres indicadores estadísticos representativos de las curvas de difusión: la proporción de uso de cada heurística de decisión y de ventas y la proporción de uso de cada heurística de decisión y de ventas a lo largo del tiempo.</p>\n<h3>Test del modelo con alto grado de difusión y olvido </h3>\n<p><br>Basándonos en el modelo de Janssen y Jager [2] los modelos configurados que tienen un alto grado de incertidumbre y satisfacción tienden a replicar el comportamiento de compra de sus amigos, es decir, el producto más popular entre ellos. <br><br>Debido a los elevados valores de probabilidad de difusión y de olvido los agentes tienden a una difusión muy temprana del conocimiento de los productos entre los agentes debido tienden a olvidar rápido los productos. Aunque exiten productos con una menor difusión (producto 1 y el producto 0) ninguno de ellos tiende a difundirse a lo largo del tiempo. Además debido que existe un equilibrio entre las opiniones de los agentes y la de sus vecinos (Beta con valor medio) evita que el modelo tienda a la compra de los mismo productos o a la compra aleatoria. Finalmente los umbrales de satisfacción y de incertidumbre altos conllevan que el modelo tienda a variar en sus compras, tal y como se predecía que se comportaría. </p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/Captura-de-pantalla-de-2020-03-23-19-10-31.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-10-31-2xl.png 1600w\"  alt=\"\" width=\"646\" height=\"815\"></figure>\n<h3>Test del modelo bajo grado de difusión y de olvido</h3>\n<figure class=\"post__image\"><br>En esta simulación se disminuirán tanto la difusión como la probabilidad de olvido de los agentes para comprobar si, en efecto, se reduce la propagación de opiniones entre los consumidores implicados en el modelo de compra. Ahora tendremos una difusión con un valor pequeño de 0.1, por ejemplo, y un \"awareness decay\" de 0.05 inferior a la difusión. Como puede observarse, se produce un cambio paulatino en la adopción de heurísticas entre repetición comparación social lo que hace que unos pocos productos lideren el mercado aunque sin una diferencia abrumadora sobre sus competidores más cercanos.<br><br> <br><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/Captura-de-pantalla-de-2020-03-23-19-12-20.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-20-2xl.png 1600w\"  alt=\"\" width=\"602\" height=\"372\"></figure>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/Captura-de-pantalla-de-2020-03-23-19-12-44.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-12-44-2xl.png 1600w\"  alt=\"\" width=\"551\" height=\"277\"></figure><br><br>En conclusión cuando los parámetros son o bien muy bajos, por lo que los agentes se satisfacen fácilmente con cualquier producto,o muy altos,con los que el agente no se satisface ni hace uso de las opiniones de los vecinos que lo rodean en el modelo, se produce un dispersión mínima en el modelo. En estos casos el uso de heurísticas suele decantarse por deliberación, en una mayor cantidad, comparación social para el caso en el que los agentes tienen muchas dificultades para estar convencidos de sus elecciones o para satisfacerse y repetición en el caso en el que los agentes son extremadamente exigentes. <br><br>En general, las pruebas de verificación realizadas muestran que el modelo se encuentra bien programado, es decir, el modelo computacional desarrollado en Mason es coherente con el modelo conceptual propuesto y no arroja resultados aberrantes o errores lógicos.</p>\n<h2>Experimentación y conclusiones </h2>\n<p><br>Una vez validado el modelo, se desea examinar los comportamientos surgidos del modelo, identificar fenómenos emergentes, distinguir y observar cómo varía el comportamiento del modelo en base al tipo de red sobre la que se ejecuta y al número consumidores semilla y a la técnica de selección de \"influentials\"). </p>\nLos experimentos realizados se agruparon en cuatro escenarios donde se varía la topología de red. En cada uno de los escenarios se analizan las curvas de difusión, el uso de las distintas heurísticas de difusión y el número total de ventas. Finalmente se compararan los escenarios entre ellos para ver en cuales de los escenarios se comporta mejor para las distintas pruebas.<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  style=\"transform: rotate(90deg);\" src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/Captura-de-pantalla-de-2020-03-23-19-41-53.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/responsive/Captura-de-pantalla-de-2020-03-23-19-41-53-2xl.png 1600w\"  width=\"586\" height=\"852\"></figure>El resto de los resultados del experimento se pueden descargar del siguiente <a href=\"https://drive.google.com/file/d/1-s_82BYgdHwezaSkwf01kIgV4nRG_D81/view?usp=sharing\" target=\"_blank\" rel=\"noopener noreferrer\">link</a>.\n<p>A partir de los resultados obtenidos concluimos que la nueva metodología de selección fue realizado exitosamente para distintas combinaciones de parámetros, para los que se logró obtener un porcentaje superior al número de ventas respecto al resto de métodos de selección. La capacidad de influencia de los promotores en la activación de los procesos de difusión del mercado a través del WOM se ve reflejada en el aumento de las ventas del mercado. Estas ventas son todas aquellas en las que el emprendedor no representa mayor esfuerzo pero que impactan significativamente en términos económicos, dado el posicionamiento del producto que se genera en el mercado a partir de las recomendaciones positivas. <br><br>A partir de los resultados obtenidos en los apartados anteriores concluimos este proyecto afirmando que existe una superioridad en la selección de consumidores semilla mediante una metodología por grado frente al resto. Aunque las métricas para la comparación de frentes dan como mejores los resultados obtenidos por grado, la adaptación a la metodología de selección de consumidores mixto también ofrece buenas resultados en alguno escenarios. <br><br>Los resultados obtenidos difieren según los parámetros de los modelos, es decir, el entorno del agente influye considerablemente en los resultados obtenidos. También adquiere relevancia en los experimentos la topología de la red, ofreciendo mayores resultados en las redes de libres de escala dónde, tal y como se explicó en las secciones iniciales del problema, los \"hubs\" ejercen una gran influencia en la difusión de productos en el entorno que termina siendo crucial para el éxito de la campaña final de ventas.</p>\n<p><a href=\"https://github.com/jaumeCloquellCapo/ABM_Social_Targeting/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">Github</a>, <a href=\"https://drive.google.com/file/d/1-s_82BYgdHwezaSkwf01kIgV4nRG_D81/view\" target=\"_blank\" rel=\"noopener noreferrer\">PDF</a>.</p>\n<h2>Bibliografia</h2>\n<ul>\n<li>[1] Bernd Skiera and Christian Barrot and Oliver Hinz and Jan U. Becker.<br>((Seeding Strategies for Viral Marketing: An Empirical Comparison)).<br>En: Journal of Marketing 75.6 (2011), págs. 55-71.</li>\n<li>[2] Eric Bonabeau. ((Agent-based Modeling: Methods and Techniques for<br>Simulating Human Systems)). En: Annual Review of Sociology 32 (2002),<br>págs. 7280-7287.</li>\n<li>[3] Marilynn Brewer y Roderick Kramer. ((Choice behavior in social dilem-<br>mas: Effects of social identity, group size, and decision framing)). En:<br>Journal of Personality and Social Psychology 50 (1986), págs. 543-549.</li>\n<li>[4] David Cartano y Rogers Everett. ((Methods of Measuring Opinion Lea-<br>dership)). En: Public Opinion Quarterly 26.3 (ene. de 1962), págs. 435-441.</li>\n<li>[5] Manuel Chica, Michael Kirley y Raymond Chiong. ((A networked N-<br>player trust game and its evolutionary dynamics)). En: IEEE Transac-<br>tions on Evolutionary Computation 22 (2018), págs. 866-878.</li>\n<li>[6] Manuel chica y William Rand. ((Building agent-based decision support<br>systems for word-of-mouth programs: a freemium application)). En:<br>Journal of Marketing Research 54.5 (2017), págs. 752-767.</li>\n<li>[7] Christian Stummer and Elmar Kiesling and Markus Günther and<br>Lea Wakolbinger. ((Agent-based simulation of innovation diffusion: A<br>review)). En: Central European Journal of Operations Research 20<br>(jun. de 2012), págs. 183-230.</li>\n<li>[8] Christophe Van den Bulte and Yogesh V. Joshi. ((New Product Diffu-<br>sion with Influentials and Imitators)). En: Marketing Science 26 (ma-<br>yo de 2007), págs. 400-421.</li>\n<li>[9] Rebecca L. Davis y Thomas W. Valente. ((Accelerating the diffusion of<br>innovations using opinion leaders)). En: The Annals of the American<br>Academy of Political and Social Science 566.1 (1999), págs. 55-67.</li>\n<li>[10] Donald R Lehmann and Jae Weon Hong and Jacob Goldenberg and<br>Sangman Han. ((The Role of Hubs in the Adoption Process)). En: Jour-<br>nal of Marketing 73.2 (2009), págs. 1-13.</li>\n<li>[11] James H. Fowler y Nicholas A. Christakis. ((The collective dynamics<br>of smoking in a large social network)). En: New England journal of<br>medicine 358.21 (2008), págs. 2249-2258.</li>\n<li>[12] Mark Granovetter. ((Economic action and social structure: The pro-<br>blem of embeddedness)). En: American Journal of Sociology 91 (1985),<br>págs. 481-510.</li>\n<li>[13] Alison Heppenstall y Andrew Crooks. Introduction to Agent-Based<br>Modelling. Ene. de 2012, págs. 85-105.</li>\n<li>[14] Oliver Hinz, Bernd Skiera y Christian Barrot and Jan Becker. ((See-<br>ding Strategies for Viral Marketing: An Empirical Comparison)). En:<br>Journal of Marketing 75.6 (2011), págs. 55-71.</li>\n<li>[15] Jagdip y Singh. ((Voice, Exit, and Negative Word-of-Mouth Behaviors:<br>An Investigation Across Three Service Categories)). En: Journal of the<br>Academy of Marketing Science 18 (dic. de 1990), págs. 1-15.</li>\n<li>[16] Jain Dipak and Mahajan Vijay and Muller Eitan. ((An Approach<br>for Determining Optimal Product Sampling for the Diffusion of a<br>New Product)). En: Journal of Product Innovation Management 12.2<br>(1995), págs. 124-135.</li>\n<li>[17] Elizabeth Kendall y George Sproles. ((A Methodology for Profiling<br>Consumers’ Decision-Making Styles)). En: Journal of Consumer Af-<br>fairs 20.2 (1986), págs. 267-279.</li>\n<li>[18] Daeho Leeb, Youngsang Cho. y Junseok Hwang. ((Identification of ef-<br>fective opinion leaders in the diffusion of technological innovation: A<br>social network approach)). En: Technological Forecasting and Social<br>Change 79.1 (2012), págs. 97-106.</li>\n<li>[19] Christopher Lettl y Jan Kratzer. ((Distinctive Roles of Lead Users<br>and Opinion Leaders in the Social Networks of Schoolchildren)). En:<br>Journal of Consumer Research 36 (2009), págs. 646-659.</li>\n<li>[20] Charles M. Macal y Michael John North. ((Agent-based modeling and<br>simulation: Desktop ABMS)). En: Proceedings - Winter Simulation<br>Conference (dic. de 2007), págs. 95-106.</li>\n<li>[21] Eitan Muller, Renana Peres y Vijay Mahajan. ((Innovation diffusion<br>and new product growth models: A critical review and research di-<br>rections)). En: International Journal of Research in Marketing 27.2<br>(2010), págs. 91-106.</li>\n<li>[22] Charles G Orosz, Gary An. y Virginia A Folcik. ((The basic immune<br>simulator: an agent-based model to study the interactions between<br>innate and adaptive immunity)). En: Theoretical Biology and Medical<br>Modelling 4 (feb. de 2007), pág. 39.</li>\n<li>[23] Patchareeya Pumpuang y Thomas Valente. ((Identifying opinion lea-<br>ders to promote behavior change)). En: Health Education Behavior<br>34.6 (2007), págs. 881-896.</li>\n<li>[24] Juan Francisco Robles, Manuel Chica y Oscar Cordón. ((Incorporating<br>awareness and genetic-based viral marketing strategies to a consumer<br>behavior model)). En: IEEE Congress on Evolutionary Computation<br>(CEC) (2016), págs. 5178-5185.</li>\n<li>[25] Roland T. Rust y William Rand. ((Agent-Based Modeling in Marke-<br>ting: Guidelines for Rigor)). En: International Journal of Research in<br>Marketing 28 (2011), págs. 181-193.</li>\n<li>[26] Arnaud Sallaberry, Faraz Zaidi y Guy Melançon. ((Generating Artifi-<br>cial Social Networks with Small World and Scalee Free Properties)).<br>En: HAL 3 (2012), págs. 1-34.</li>\n<li>[27] Miklos Sarvary, Peter Pal Zubcsek y Zsolt Katona. ((Network Effects<br>and Personal Influences: The Diffusion of an Online Social Network)).<br>En: Journal of Marketing Research 48 (2011), págs. 425-443.</li>\n<li>[28] Jager Wander y Marco A Janssen. ((Simulating Market Dynamics: In-<br>teractions between Consumer Psychology and Social Networks)). En:<br>Artificial Life 9.4 (2003), págs. 343-356.</li>\n<li>[29] Jinhong Xie y Yubo Chen. ((Online Consumer Review: Word-of-Mouth<br>as a New Element of Marketing Communication Mix)). En: Manage-<br>ment Science 54 (mar. de 2008), págs. 477-491.</li>\n<li>[30] Faraz Zaidi. ((Small World Networks and Clustered Small World Net-<br>works with Random Conectivity)). En: Social Network Analysis and<br>Mining 3 (2013), págs. 51-63.</li>\n</ul>\n<p> </p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/14/face.jpg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Marketing",
                   "Machine Learning",
                   "Agent-based modeling"
            ],
            "date_published": "2020-03-23T17:49:59+01:00",
            "date_modified": "2020-03-29T17:29:50+02:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/config-powertop-options-at-boot-time.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/config-powertop-options-at-boot-time.html",
            "title": "Config PowerTOP options at boot time",
            "summary": "Recently I upgraded from Macbook Pro Mid 2015 to Dell XPS 15 9570, with a 8th Gen Core i7-8750H, 8GB DDR4 RAM, 250GB M.2 2280 PCIe SSD and NVIDIA GeForce GTX 1050Ti this thing is straight up beast. I went with FHD version instead 4k&hellip;",
            "content_html": "<header class=\"entry-header\">\n<div class=\"entry-header-wrap\">\n<p class=\"entry-title\">Recently I upgraded from Macbook Pro Mid 2015 to Dell XPS 15 9570, with a 8th Gen Core i7-8750H, 8GB DDR4 RAM, 250GB M.2 2280 PCIe SSD and <strong>NVIDIA GeForce GTX 1050T<em>i</em></strong> this thing is straight up beast. I went with FHD version instead 4k and with 400nits screen brightness (&gt; MBP 2018) and its get really bright.</p>\n<p>This post I will explain how to fix a issues with the latest Ubuntu 19.10 running on said laptop. The problem is the CPU will run quite hot and will quickly drain the battery. Install powertop and thermald to fix this. To Solved it, I will show you how to set all tunable PowerTOP options at boot time using systemd service </p>\n</div>\n</header>\n<div class=\"entry-content\">\n<p>Create <em>systemd</em> service file.</p>\n<pre>$ cat &lt;&lt; EOF | sudo tee /etc/systemd/system/powertop.service\n[Unit]\nDescription=PowerTOP auto tune\n\n[Service]\nType=idle\nEnvironment=\"TERM=dumb\"\nExecStart=/usr/sbin/powertop --auto-tune\n\n[Install]\nWantedBy=multi-user.target\nEOF\n</pre>\n<div class=\"alert alert-info\">Notice that I have used <strong>idle</strong> process start-up type and defined <strong>TERM</strong> environment variable.</div>\n<p>Reload systemd manager configuration.</p>\n<pre>$ sudo systemctl daemon-reload\n</pre>\n<p>Enable service at boot time.</p>\n<pre>$ sudo systemctl enable powertop.service\n</pre>\n</div>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/12/Kg2aj.png",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Linux"
            ],
            "date_published": "2019-12-14T11:45:40+01:00",
            "date_modified": "2019-12-14T11:45:40+01:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/sistemas-complejos-y-redes-sociales.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/sistemas-complejos-y-redes-sociales.html",
            "title": "Sistemas Complejos y Redes Sociales.",
            "summary": "Las redes sociales son la base del modelado basado en agentes ya que representan las conexiones entre los agentes que forman los sistemas a estudiar y tienen un gran peso en la influencia de estos. No sólo son la base sino que también son muy&hellip;",
            "content_html": "<p>Las redes sociales son la base del modelado basado en agentes ya que representan las conexiones entre los agentes que forman los sistemas a estudiar y tienen un gran peso en la influencia de estos. No sólo son la base sino que también son muy útiles para estudiar comportamientos emergentes en los sistemas que creamos, utilizarlas para comprobar cómo cambia el comportamiento del modelo en función de la estructura de la red o medir el impacto que tiene ésta en los resultados obtenidos.</p>\n<p>El objetivo de este post es evaluar las distintas redes sociales que existen, mostrando, ventajas y desventajas de cada una de ellas.</p>\n<h2>Influencia de las redes sociales en el modelado basado en agentes.</h2>\n<p>En los sistemas simulados mediante el modelado basado en agentes no basta con la única incorporación de los agentes para la toma de decisiones ya que como hemos comentado anteriormente la estructura de las redes donde se lleva a cabo la difusión de las opiniones y el diálogo entre los agentes influye poderosamente en el funcionamiento del sistema. Así, la simulación basada en agentes y el análisis de redes sociales se unen para explicar la aparición de distintos fenómenos biológicos, culturales, sociales o históricos como, por ejemplo, cómo ha sido posible que las ideas del cristianismo (frente a otras religiones) se propagasen por todo el Imperio romano hasta llegar a convertirse en una de las religiones más importantes de la historia.</p>\n<p>En resumen, son muchas las ventajas de combinar el análisis de redes y modelos<br>basados en agentes para diseñar modelos empíricos de la realidad: los experimentos de laboratorio proporcionan datos sobre el comportamiento de los agentes y el análisis de redes suministra información acerca de la estructura de interacción entre los agentes sobre los que construir dichos modelos.</p>\n<h2>Redes aleatorias.</h2>\n<p><br>Las redes aleatorias se conocen en teoría de grafos como modelo <strong>Erdös–Rényi</strong> por<br>aparecer en un estudio realizado por los matemáticos <strong>Paul Erdös y Alfréd Rény</strong>i y<br>representan uno de los métodos empleados en la generación de grafos aleatorios. Este<br>modelo de redes se basa en que un nuevo nodo se enlaza con igual probabilidad con el<br>resto de la red y, por consiguiente, posee una independencia estadística con el resto de<br>nodos de la red.</p>\n<p>En la actualidad representa una base teórica en la generación de otras redes. Para comprender conceptualmente el modelo diseñado por Erdös–Rényi  podríamos consideramos N nodos distribuidos de forma aleatoria en una red sin enlaces. Dicha red comenzaría a unirse enlazando dos nodos cualesquiera y, en pasos posteriores, se irían enlazando aleatoriamente otras parejas de nodos (descartando aquellos nodos que ya se encuentren enlazados). Repitiendo el proceso un número M de veces, habremos establecido como máximo M enlaces entre las parejas de nodos. Así, si M es un valor pequeño con respecto al valor total de nodos muchos de los nodos se encontrarán aislados (desconectados del resto) y otros estarán formando pequeñas islas. Por el contrario, si M es grande en comparación con el número total de nodos, es muy probable que casi todos los nodos se encuentren conectados entre sí formando una única componente gigante. Cuando se da esta forma de enlace entre los nodos,<br>aparecen propiedades específicas en la distribución de grado P(k) como, por ejemplo,<br>que sigue la forma de una distribución de Poisson 9 . </p>\n<p> </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/sci2figure4.17.jpg\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-xs.jpg 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-sm.jpg 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-md.jpg 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-lg.jpg 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-xl.jpg 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/sci2figure4.17-2xl.jpg 1600w\"  width=\"501\" height=\"193\"></figure>\n<p>Durante muchas décadas a partir de los años 1950 se pensó que las redes con esta característica eran las más adecuadas para describir ciertas redes complejas y pronto se vio que no era del todo cierto.</p>\n<h3>Redes de libre escala</h3>\n<p>Las redes libres de escala son un tipo específico de red compleja en las que se pueden<br>apreciar una minoría de nodos con un gran número de enlaces a otros nodos mientras<br>que en el resto de los nodos que forman la red el grado de conexión es bastante bajo.<br>Este modelo de red compleja surgió durante un estudio encabezado por Lászlo<br>Barabási 10 y sus colaboradores de la Universidad de Notre Dame en el que<br>implementaron un mapa de la Web.Durante el estudio observaron que la web no<br>presentaba una distribución del grado de conectividad usual sino que existían unos<br>pocos nodos, a los que llamaron \"Hubs 11 \", que estaban mucho más conectados que el esto.</p>\n<p>Las diferencias principales entre una red aleatoriay otra libre de escala se encuentran en la cola de la distribución:</p>\n<ul>\n<li>Para valores pequeños de k, la ley de la potencia está <span class=\"\">por encima de la de <span class=\"highlight selected\">Pois</span>son: </span>la red libre de escala tiene un número alto de nodos con grado pequeño</li>\n<li>Para k‘s cercanos a &lt;k<span class=\"\">&gt;, la distribución de Poisson</span>e stá por encima de la ley de la potencia: en una red aleatoria hay muchos nodos con grado k≈&lt;k&gt;</li>\n<li>Para valores altos de k, la ley de la potencia vuelve a <span class=\"\">estar por encima de la de Poisson: </span>la posibilidad de encontrar un nodo de grado alto, un hub, es varios órdenes de magnitud mayor en una red libre de escala</li>\n</ul>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/Captura-de-pantalla-de-2019-12-07-17-50-55.png\" sizes=\"(max-width: 48em) 100vw, 768px\" srcset=\"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-xs.png 300w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-sm.png 480w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-md.png 768w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-lg.png 1024w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-xl.png 1360w ,https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/responsive/Captura-de-pantalla-de-2019-12-07-17-50-55-2xl.png 1600w\"  width=\"322\" height=\"387\"></figure>\n<p> </p>\n<h2>Redes de Mundo Pequeño</h2>\n<p>Una red de mundo pequeño es un tipo de grafo para el que la mayoría de los nodos no<br>son vecinos entre sí y en el que, sin embargo, la mayoría de los nodos pueden ser<br>alcanzados desde cualquier nodo origen a través de un número corto de saltos entre<br>ellos. Por otro lado, los grafos aleatorios muestran el efecto de mundo pequeño, pero no el de clusterización. </p>\n<p>En el caso de una red social, donde los nodos representan personas y los enlaces son las  entre estas personas, se puede decir que captura muchos de los fenómenos de las redes de relaciones mundo pequeño. </p>\n<p>La generación de redes de mundos pequeños se centra en dos propiedades:</p>\n<ul>\n<li>El fenómeno del mundo pequeño: cualesquiera dos nodos de la red se comunican por un camino de nodos intermedios relativamente pequeño. Comprobando que la distancia máxima entre dos nodos crece logarítmicamente con el número de nodos en la red.</li>\n</ul>\n<ul>\n<li>Poseen valores altos de coeficiente de agrupamiento: si dos nodos no están<br>conectados directamente entre sí existe una gran probabilidad de que<br>conecten mediante la intervención de otros nodos. </li>\n</ul>\n<p>Los modelos de mundo pequeño, tienen sus raíces en las redes sociales no virtuales, donde la mayoría de la gente es amiga de sus vecinos físicos inmediatos, por ejemplo los vecinos en la misma calle o compañeros en la misma oficina. Por otro lado, muchas personas tienen un par de amigos que están lejos, en la distancia, como amigos de otros países, que están representados por las conexiones de largo alcance creadas por el procedimiento de reconexión que hemos visto.</p>\n<p> </p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/8/pattern-nature-network-merl.jpg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Agent-based modeling"
            ],
            "date_published": "2019-12-07T13:30:05+01:00",
            "date_modified": "2020-03-19T19:55:25+01:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommend-products-using-cloud-sql-and-sparkml.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommend-products-using-cloud-sql-and-sparkml.html",
            "title": "Recommend products using Cloud SQL and SparkML",
            "summary": "In this post, we suppose that we have an existing on-premise architecture for housing rental recommendation. Our objective will be to migrate this infrastructure to Google Cloud Platform (GPC). Machine Learning is done using PySpark SparkML library. What we are goint to do?: First, let’s see&hellip;",
            "content_html": "<p>In this post, we suppose that we have an existing on-premise architecture for housing rental recommendation. Our objective will be to migrate this infrastructure to Google Cloud Platform (GPC). Machine Learning is done using PySpark SparkML library.</p>\n<p>What we are goint to do?:</p>\n<ul>\n<li>Create Cloud SQL instance</li>\n<li>Create database tables by importing .sql files from Cloud Storage</li>\n<li>Populate the tables by importing .csv files from Cloud Storage</li>\n<li>Allow access to Cloud SQL</li>\n<li>Explore the rentals data using SQL statements from CloudShell</li>\n<li>Lauch Dataproc and load ML Models</li>\n<li>Explore results</li>\n<li>Clean UP</li>\n</ul>\n<h2>Create a Goole Cloud SQL instance</h2>\n<p>First, let’s see how GCP dashboard look like at <a href=\"https://console.cloud.google.com/home/dashboard\" class=\"da by gy gz ha hb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this url</a> and you will see something like this: On the GCP Console, from the Storage tab, click on “SQL”, and create an instance.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_67.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Select the MySQL instance.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_68.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Set the instance name to <code class=\"language-plaintext highlighter-rouge\">rentals</code> and define a password (make sure to remember it) :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_69.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Allocate 2 vCPUs to your Master and Nodes.</p>\n<p>The instance will then start :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_70.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You’ll have to wait a few minutes in order for the instance to be ready. Once ready, click on the name of the instance to access instance details. The Cloud SQL dashboard is split into multiple tabs:</p>\n<ul>\n<li><strong>Overview</strong>: This is the home tab of our SQL database. The first visible component is a chart of our db's performance over time, where we can set the metric to whatever we want (pictured as \"CPU utilization\"). This tab is also where we can easily find connection details to our database, or even connect to the database directly using Google's \"Cloud Shell\" terminal.</li>\n<li><strong>Users</strong>: Manage the database users on this instance.</li>\n<li><strong>Databases</strong>: Create or delete top-level databases in this instance.</li>\n<li><strong>Backups</strong>: Either schedule automated backups, or create an ad-hoc backup on the spot.</li>\n<li><strong>Replicas</strong>: Replicate data in this Cloud SQL instance to other Cloud SQL databases, or an external database.</li>\n<li><strong>Operations</strong>: Log of high-level database operations, such as backups.</li>\n</ul>\n<h2>Create tables</h2>\n<p id=\"3b79\" class=\"gc gd ed at ge b gf hq gh hr gj hs gl ht gn hu gp\" data-selectable-paragraph=\"\">You just need to connect to the CloudSQL and use your standard query SQL to create new database, new table etc. But some people might have difficulty to connect with CloudSQL database. Well, at least for me I froze for 2 whole minutes before I figure out there is a button to connect to it. There are 2 methods that I have tried to connect which are using Google Cloud Shell and by giving authorization to my network. There are other method like using SSL to connect but I will not cover that in this article since I haven’t tried it yet.</p>\n<p id=\"1256\" class=\"gc gd ed at ge b gf gg gh gi gj gk gl gm gn go gp\" data-selectable-paragraph=\"\">To connect using Google Cloud Shell you just need to open your CloudSQL dashboard, click on the Instance ID that you just create and click on “Connect using cloud shell”. </p>\n<p data-selectable-paragraph=\"\"><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_71.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p data-selectable-paragraph=\"\">After you click that button, it will open google cloud shell and you need to press Enter to run the command there. As usual when you press enter, you might need to wait for several minutes for google to whitelist your IP. After that you can type your MySQL password to login into your MySQL database.</p>\n<p data-selectable-paragraph=\"\"><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_72.jpg\" data-is-external-image=\"true\"  alt=\"image\"> </p>\n<p>A SQL shell is now ready. You can type SQL queries. Start for example with :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>SHOW DATABASES;</code></pre>\n</div>\n</div>\n<p>It should the structure of the existing database. We will then create 3 tables :</p>\n<ul>\n<li>A Recommendation table that attache recommendation to a user I</li>\n<li>An Accommodation table that describes the accommodation</li>\n<li>A Rating table that describes the rating of each accommodation</li>\n</ul>\n<p>To create the tables, run the following query :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>CREATE DATABASE IF NOT EXISTS recommendation_spark;\n\nUSE recommendation_spark;\n\nDROP TABLE IF EXISTS Recommendation;\nDROP TABLE IF EXISTS Rating;\nDROP TABLE IF EXISTS Accommodation;\n\nCREATE TABLE IF NOT EXISTS Accommodation\n(\n    id varchar(255),\n    title varchar(255),\n    location varchar(255),\n    price int,\n    rooms int,\n    rating float,\n    type varchar(255),\n    PRIMARY KEY (ID)\n);\n\nCREATE TABLE  IF NOT EXISTS Rating\n(\n    userId varchar(255),\n    accoId varchar(255),\n    rating int,\n    PRIMARY KEY(accoId, userId),\n    FOREIGN KEY (accoId) \n    REFERENCES Accommodation(id)\n);\n\nCREATE TABLE  IF NOT EXISTS Recommendation\n(\n    userId varchar(255),\n    accoId varchar(255),\n    prediction float,\n    PRIMARY KEY(userId, accoId),\n    FOREIGN KEY (accoId) \n    REFERENCES Accommodation(id)\n);\n\nSHOW DATABASES;\n</code></pre>\n</div>\n</div>\n<p>We will use the <code class=\"language-plaintext highlighter-rouge\">recommendation_spark</code> table :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>MySQL [recommendation_spark]&gt; USE recommendation_spark;\nDatabase changed\nMySQL [recommendation_spark]&gt; SHOW TABLES;\n+--------------------------------+\n| Tables_in_recommendation_spark |\n+--------------------------------+\n| Accommodation                  |\n| Rating                         |\n| Recommendation                 |\n+--------------------------------+\n3 rows in set (0.11 sec)\nMySQL [recommendation_spark]&gt;\n</code></pre>\n</div>\n</div>\n<h2 id=\"store-data-in-google-cloud-storage\">Store data in Google Cloud Storage</h2>\n<p>Alright, how do we import data in those tables then? There are 2 options, either through the UI or through the command lines.  I will explain the two options though i used commands lines</p>\n<p>First, let’s see how GCP dashboard look like at <a href=\"https://console.cloud.google.com/home/dashboard\" class=\"da by gy gz ha hb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this url</a> and you will see something like this: </p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://miro.medium.com/max/1440/1*xOw_TG_ficYxth84sNUL7Q.png\" data-is-external-image=\"true\"  width=\"1440\" height=\"775\"></figure>\n<p id=\"4fef\" class=\"gc gd ed at ge b gf gg gh gi gj gk gl gm gn go gp\" data-selectable-paragraph=\"\">On the left bar you can see all the services that google provides you. For now let’s choose storage and click “Browser”. By the way, you could pin the storage button, so it will be displayed on top the next time you open the dashboard. This feature is definitely a big help for someone like me who is too lazy to scroll down and somehow still can’t find the menu I’m looking for.</p>\n<p id=\"a173\" class=\"gc gd ed at ge b gf gg gh gi gj gk gl gm gn go gp\" data-selectable-paragraph=\"\">After that, we will need to create new bucket for our google storage by clicking “CREATE BUCKET” on the interface as illustrated below:</p>\n<figure class=\"post__image post__image--center\"><img loading=\"lazy\"  src=\"https://miro.medium.com/max/1440/1*R7KrmslMeR1GaMKkoR6oRw.png\" data-is-external-image=\"true\"  width=\"1440\" height=\"777\"></figure>\n<p>Then, just fill the form depends on what you need and finally click create. At this step, you might need to wait for several minutes for GCP to create your bucket. In case you doesn’t know what bucket is, you can imagine it like a your local storage partition and the process that we’re doing now is just creating new partition in our cloud storage.</p>\n<p>After you create a bucket, you can upload and download to google storage using the console.</p>\n<p>If yout \"pro terminal\" here, we will use the command lines. Open a new tab in the Shell and type the following command :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>echo \"Creating bucket: gs://$DEVSHELL_PROJECT_ID\"\ngsutil mb gs://$DEVSHELL_PROJECT_ID\n\necho \"Copying data to our storage from public dataset\"\ngsutil cp gs://cloud-training/bdml/v2.0/data/accommodation.csv gs://$DEVSHELL_PROJECT_ID\ngsutil cp gs://cloud-training/bdml/v2.0/data/rating.csv gs://$DEVSHELL_PROJECT_ID\n\necho \"Show the files in our bucket\"\ngsutil ls gs://$DEVSHELL_PROJECT_ID\n\necho \"View some sample data\"\ngsutil cat gs://$DEVSHELL_PROJECT_ID/accommodation.csv\n</code></pre>\n</div>\n</div>\n<p>These lines (using <code class=\"language-plaintext highlighter-rouge\">gsuitl</code>) load the accommodation and rating CSV files. The last line (<code class=\"language-plaintext highlighter-rouge\">gsutil cat</code>) displays the content a preview of the accommodation table.</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>gsutil cat gs://$DEVSHELL_PROJECT_ID/accommodation.csv\n1,Comfy Quiet Chalet,Vancouver,50,3,3.1,cottage\n2,Cozy Calm Hut,London,65,2,4.1,cottage\n3,Agreable Calm Place,London,65,4,4.8,house\n4,Colossal Quiet Chateau,Paris,3400,16,2.7,castle\n5,Homy Quiet Shack,Paris,50,1,1.1,cottage\n</code></pre>\n</div>\n</div>\n<h2 id=\"move-data-from-cloud-storage-to-cloud-sql\">Move data from Cloud Storage to Cloud SQL</h2>\n<p>At that point, the data is in Google Cloud Storage. Our tables are however in Cloud SQL. We need to move the files in the SQL tables. From the SQL instance details page, click on “Import” :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_74.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Apply the following procedure for both <code class=\"language-plaintext highlighter-rouge\">accomodation.csv</code> and <code class=\"language-plaintext highlighter-rouge\">rating.csv</code> :</p>\n<ul>\n<li>browse and select the file</li>\n<li>make sure the format is in CSV</li>\n<li>select <code class=\"language-plaintext highlighter-rouge\">recommendation_spark</code> as the database</li>\n<li>give it the names Accomoddation or Rating respectively (or anything else if you changed the names of the tables when you created them)</li>\n</ul>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_74.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<h2 id=\"explore-data-from-cloud-sql\">Explore data from Cloud SQL</h2>\n<p>To display the content of the rating tables, go back to the SQL instance name, and connect to the instance using Cloud shell. Wait a bit and type your password. From the Shell, start exploring the data by running SQL queries :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>SELECT * FROM Rating\nLIMIT 15;\n</code></pre>\n</div>\n</div>\n<p>We can build SQL queries to see how many ratings we have overall :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>SELECT COUNT(*) AS num_ratings \nFROM Rating;\n</code></pre>\n</div>\n</div>\n<p>Or find the user that wrote the most ratings :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>SELECT userId,\nCOUNT(rating) AS num_ratings\nFROM Rating \nGROUP BY userId\nORDER BY num_ratings DESC;\n</code></pre>\n</div>\n</div>\n<p>We won’t need the SQL shell anymore, you can safely exit :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>exit\n</code></pre>\n</div>\n</div>\n<h2 id=\"launch-dataproc\">Launch Dataproc</h2>\n<p>As discussed in a previous article, we need to allow Cloud Dataproc to connect with Cloud SQL, since the computation and the storage are split.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_73.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You need to create a Cloud Dataproc cluster as we did in the previous lab. Name the cluster <code class=\"language-plaintext highlighter-rouge\">rentals</code>, and leave all settings to their default value.</p>\n<p>We now need to allow Dataproc to access this specific SQL Cluster. You might need to change the CLUSTER, CLOUDSQL, ZONE or NWORKERS variables if you changed something previously. On the shell that is remaining (not the SQL one), execute the following command :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>echo \"Authorizing Cloud Dataproc to connect with Cloud SQL\"\nCLUSTER=rentals\nCLOUDSQL=rentals\nZONE=us-central1-a\nNWORKERS=2\n\nmachines=\"$CLUSTER-m\"\nfor w in `seq 0 $(($NWORKERS - 1))`; do\n    machines=\"$machines $CLUSTER-w-$w\"\ndone\n\necho \"Machines to authorize: $machines in $ZONE ... finding their IP addresses\"\nips=\"\"\nfor machine in $machines; do\n    IP_ADDRESS=$(gcloud compute instances describe $machine --zone=$ZONE --format='value(networkInterfaces.accessConfigs[].natIP)' | sed \"s/\\[u'//g\" | sed \"s/'\\]//g\" )/32\n    echo \"IP address of $machine is $IP_ADDRESS\"\n    if [ -z  $ips ]; then\n        ips=$IP_ADDRESS\n    else\n        ips=\"$ips,$IP_ADDRESS\"\n    fi\ndone\n\necho \"Authorizing [$ips] to access cloudsql=$CLOUDSQL\"\ngcloud sql instances patch $CLOUDSQL --authorized-networks $ips\n</code></pre>\n</div>\n</div>\n<h2 id=\"load-ml-models\">Load ML models</h2>\n<p>The ML models are already built in this exercise. We need to load the models (as if they were already built by the Data Science teams). The script is written in PySpark.</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>gsutil cp gs://cloud-training/bdml/v2.0/model/train_and_apply.py train_and_apply.py\n</code></pre>\n</div>\n</div>\n<p>We then need to edit the file :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>cloudshell edit train_and_apply.py\n</code></pre>\n</div>\n</div>\n<p>Replace your Cloud SQL IP (most likely your project name), and your password :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_76.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You can save the file and quit the editor.</p>\n<p>Then, copy this file to your Cloud Storage bucket using this Cloud Shell command:</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>gsutil cp train_and_apply.py gs://$DEVSHELL_PROJECT_ID\n</code></pre>\n</div>\n</div>\n<h2 id=\"run-jobs-on-dataproc\">Run Jobs on DataProc</h2>\n<p>We can now run our ML jobs on Dataproc. On the DataProc Job tab, click on “Submit Job” :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_77.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Change the name of the cluster to <code class=\"language-plaintext highlighter-rouge\">rentals</code>, and the Job type to PySpark. For the main Python file, it should have the following format :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>gs://&lt;bucket-name&gt;/train_and_apply.py\n</code></pre>\n</div>\n</div>\n<p>Where you can replace your bucket name. In my example :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_78.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>The job should take around 5 minutes to run.</p>\n<h2 id=\"explore-results\">Explore results rows</h2>\n<p>If you still have your SQL Shell, use it again (launch it as previously).</p>\n<p>We will use the <code class=\"language-plaintext highlighter-rouge\">recommenation_spark</code> table.</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>USE recommendation_spark;\n\nSELECT COUNT(*) AS count FROM Recommendation;\n</code></pre>\n</div>\n</div>\n<p>For a given user, we retrieve the recommendations in the following way :</p>\n<p> </p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>SELECT \n    r.userid, \n    r.accoid, \n    r.prediction, \n    a.title, \n    a.location, \n    a.price, \n    a.rooms, \n    a.rating, \n    a.type \nFROM Recommendation as r \nJOIN Accommodation as a \nON r.accoid = a.id \nWHERE r.userid = 10;</code></pre>\n</div>\n</div>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\"><code>+--------+--------+------------+-------------------------+--------------+-------+-------+--------+---------+\n| userid | accoid | prediction | title                   | location     | price | rooms | rating | type    |\n+--------+--------+------------+-------------------------+--------------+-------+-------+--------+---------+\n| 10     | 21     |  1.5929456 | Big Peaceful Cabin      | Seattle      |    80 |     2 |    4.9 | cottage |\n| 10     | 31     |  1.4377488 | Colossal Private Castle | Buenos Aires |  1400 |    15 |    3.3 | castle  |\n| 10     | 41     |  1.3913738 | Big Calm Manor          | Seattle      |   800 |    11 |    2.7 | mansion |\n| 10     | 7      |    1.32196 | Vast Peaceful Fortress  | Seattle      |  3200 |    24 |    1.9 | castle  |\n| 10     | 2      |  1.3101096 | Cozy Calm Hut           | London       |    65 |     2 |    4.1 | cottage |\n+--------+--------+------------+-------------------------+--------------+-------+-------+--------+---------+<br><br>These are the five accommodations that we would recommend to her. Note that the quality of the recommendations are not great because our dataset was so small (note that the predicted ratings are not very high). Still, this codelab illustrates the process you'd go through to create product recommendations.<br><br><br>\n</code></div>\n<div class=\"highlight\">\n<div class=\"instructions style-scope google-codelab-step\">\n<div class=\"inner style-scope google-codelab-step\">\n<h2 id=\"title\" class=\"style-scope google-codelab-step\"><span class=\"style-scope google-codelab-step\">Clean up</span></h2>\n<p>We will not use CloudSQL and Dataproc any more in this course, so clean up so as to avoid wasting those computational resources:</p>\n<p>In GCP console, navigate to Cloud SQL, click on the hyperlink corresponding to the rentals instance and click on Delete in the top menu bar. After in GCP console, navigate to Dataproc, click on the checkbox corresponding to cluster-1 and click on Delete in the top menu bar.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/4/MLlib-la-biblioteca-de-Machine-Learning-de-Spark.png",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Road to Google Cloud Platform Certification"
            ],
            "date_published": "2019-12-07T03:42:03+01:00",
            "date_modified": "2019-12-07T21:36:01+01:00"
        },
        {
            "id": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/from-zero-to-an-apache-spark-job.html",
            "url": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/from-zero-to-an-apache-spark-job.html",
            "title": "Running a Apache Spark job on Cloud DataProc",
            "summary": "In this lab, we will launch Apache Spark jobs on Could DataProc, to estimate the digits of Pi in a distributed fashion. From the console on GCP, on the side menu, click on DataProc and Clusters. You might be needed to enable API, so just&hellip;",
            "content_html": "<p>In this lab, we will launch Apache Spark jobs on Could DataProc, to estimate the digits of Pi in a distributed fashion.</p>\n<p>From the console on GCP, on the side menu, click on DataProc and Clusters.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_54.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You might be needed to enable API, so just click on the button. Then, you are redirected to a page where you can create clusters. Click on Create Clusters.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_55.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Change the name of the cluster if you want, and leave all the other parameters to default. Then, click on “Create” to create the cluster.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_56.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>The cluster will now start.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_57.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Then, move to the “Jobs” tab.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_58.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>Click on the “Submit a job” button. You can give your job a specific name, and make sure to change the job’s type to Spark rather than Hadoop.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_59.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>We will be using one of the pre-defined jobs in Spark examples. To do so, in the field “Main class or jar”, simply type :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>org.apache.spark.examples.SparkPi\n</code></pre>\n</div>\n</div>\n<p>The code for this job can be found on Github. What this essentially does is to run a Monte Carlo simulation of pairs of X and Y coordinates in a unit circle and use the definition of the area to retrieve the Pi estimate.</p>\n<div class=\"language-java highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"n\">org</span><span class=\"o\">.</span><span class=\"na\">apache</span><span class=\"o\">.</span><span class=\"na\">spark</span><span class=\"o\">.</span><span class=\"na\">examples</span><span class=\"o\">;</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">org.apache.spark.SparkConf</span><span class=\"o\">;</span>\n<span class=\"kn\">import</span> <span class=\"nn\">org.apache.spark.api.java.JavaRDD</span><span class=\"o\">;</span>\n<span class=\"kn\">import</span> <span class=\"nn\">org.apache.spark.api.java.JavaSparkContext</span><span class=\"o\">;</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">java.util.ArrayList</span><span class=\"o\">;</span>\n<span class=\"kn\">import</span> <span class=\"nn\">java.util.List</span><span class=\"o\">;</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">final</span> <span class=\"kd\">class</span> <span class=\"nc\">SparkPi</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"nc\">Exception</span> <span class=\"o\">{</span>\n        <span class=\"kd\">final</span> <span class=\"nc\">SparkConf</span> <span class=\"n\">sparkConf</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SparkConf</span><span class=\"o\">().</span><span class=\"na\">setAppName</span><span class=\"o\">(</span><span class=\"s\">\"SparkPi\"</span><span class=\"o\">);</span>\n        <span class=\"kd\">final</span> <span class=\"nc\">JavaSparkContext</span> <span class=\"n\">jsc</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">JavaSparkContext</span><span class=\"o\">(</span><span class=\"n\">sparkConf</span><span class=\"o\">);</span>\n\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">slices</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"nc\">Integer</span><span class=\"o\">.</span><span class=\"na\">parseInt</span><span class=\"o\">(</span><span class=\"n\">args</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">])</span> <span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">;</span>\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"mi\">100000</span> <span class=\"o\">*</span> <span class=\"n\">slices</span><span class=\"o\">;</span>\n        <span class=\"kd\">final</span> <span class=\"nc\">List</span><span class=\"o\">&lt;</span><span class=\"nc\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">ArrayList</span><span class=\"o\">&lt;&gt;(</span><span class=\"n\">n</span><span class=\"o\">);</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">n</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n            <span class=\"n\">l</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n\n        <span class=\"kd\">final</span> <span class=\"nc\">JavaRDD</span><span class=\"o\">&lt;</span><span class=\"nc\">Integer</span><span class=\"o\">&gt;</span> <span class=\"n\">dataSet</span> <span class=\"o\">=</span> <span class=\"n\">jsc</span><span class=\"o\">.</span><span class=\"na\">parallelize</span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"o\">,</span> <span class=\"n\">slices</span><span class=\"o\">);</span>\n\n        <span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">count</span> <span class=\"o\">=</span> <span class=\"n\">dataSet</span><span class=\"o\">.</span><span class=\"na\">map</span><span class=\"o\">(</span><span class=\"n\">integer</span> <span class=\"o\">-&gt;</span> <span class=\"o\">{</span>\n            <span class=\"kt\">double</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"nc\">Math</span><span class=\"o\">.</span><span class=\"na\">random</span><span class=\"o\">()</span> <span class=\"o\">*</span> <span class=\"mi\">2</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"o\">;</span>\n            <span class=\"kt\">double</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"nc\">Math</span><span class=\"o\">.</span><span class=\"na\">random</span><span class=\"o\">()</span> <span class=\"o\">*</span> <span class=\"mi\">2</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"o\">;</span>\n            <span class=\"k\">return</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">*</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">y</span> <span class=\"o\">*</span> <span class=\"n\">y</span> <span class=\"o\">&lt;</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">?</span> <span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span><span class=\"o\">;</span>\n        <span class=\"o\">}).</span><span class=\"na\">reduce</span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">b</span><span class=\"o\">);</span>\n\n        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Pi is roughly \"</span> <span class=\"o\">+</span> <span class=\"mf\">4.0</span> <span class=\"o\">*</span> <span class=\"n\">count</span> <span class=\"o\">/</span> <span class=\"n\">n</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre>\n</div>\n</div>\n<p>You can set the Jar files field to :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>file:///usr/lib/spark/examples/jars/spark-examples.jar\n</code></pre>\n</div>\n</div>\n<p>The job takes arguments, which can be set to 1000 here :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_60.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You can then click on “Submit” to submit your job. From the cluster tab, you can click on the name of the cluster and access a cluster monitoring dashboard :</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_61.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>If you click on “Jobs” in the Cluster tabs, you’ll notice the progress of the job we launched. It took 46 seconds in my case.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_62.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You can click on the name of the job.</p>\n<p><img loading=\"lazy\" src=\"https://maelfabien.github.io/assets/images/gcp_63.jpg\" data-is-external-image=\"true\"  alt=\"image\"></p>\n<p>You will directly see the output that states :</p>\n<div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\">\n<pre class=\"highlight\"><code>19/07/31 21:55:46 INFO org.apache.hadoop.yarn.client.api.impl.YarnClientImpl: Submitted application application_1564609038185_0001\n\nPi is roughly 3.1418519514185195\n\n19/07/31 21:56:12 INFO org.spark_project.jetty.server.AbstractConnector: Stopped Spark@5288ab42{HTTP/1.1,[http/1.1]}{0.0.0.0:4040}\n\nJob output is complete\n</code></pre>\n</div>\n</div>\n<p>If you don’t need it anymore, make sure to <strong>DELETE</strong> the cluster.</p>",
            "image": "https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/3/maxresdefault.jpg",
            "author": {
                "name": "jaume cloquell capo"
            },
            "tags": [
                   "Road to Google Cloud Platform Certification"
            ],
            "date_published": "2019-12-07T02:44:15+01:00",
            "date_modified": "2019-12-07T05:22:08+01:00"
        }
    ]
}
