<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Recommendation Systems in GCP - jaumecloquellcapo</title><meta name="description" content="In this section, we will review product recommendations using Cloud SQL and Apache Spark. E-commerce is probably the most common recommendation systems that we encounter. Models learn what we may like based on our preferences. We can give implicit or explicit feedback to the model&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommendation-systems-in-gcp-week-1-module-2.html"><link rel="amphtml" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/amp/recommendation-systems-in-gcp-week-1-module-2.html"><link rel="alternate" type="application/atom+xml" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/feed.json"><meta property="og:title" content="Recommendation Systems in GCP"><meta property="og:image" content="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/indice.png"><meta property="og:site_name" content="jaumecloquellcapo"><meta property="og:description" content="In this section, we will review product recommendations using Cloud SQL and Apache Spark. E-commerce is probably the most common recommendation systems that we encounter. Models learn what we may like based on our preferences. We can give implicit or explicit feedback to the model&hellip;"><meta property="og:url" content="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommendation-systems-in-gcp-week-1-module-2.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/website/favicon.ico" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/css/style.css?v=070d93baee55611c69660b27e7d8e9db"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommendation-systems-in-gcp-week-1-module-2.html"},"headline":"Recommendation Systems in GCP","datePublished":"2019-12-07T02:14","dateModified":"2019-12-07T05:22","image":{"@type":"ImageObject","url":"https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/indice.png","height":225,"width":225},"description":"In this section, we will review product recommendations using Cloud SQL and Apache Spark. E-commerce is probably the most common recommendation systems that we encounter. Models learn what we may like based on our preferences. We can give implicit or explicit feedback to the model&hellip;","author":{"@type":"Person","name":"jaume cloquell capo"},"publisher":{"@type":"Organization","name":"jaume cloquell capo"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/">jaumecloquellcapo</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/" title="https://jaumecloquellcapo.github.io/jaumeCloquellCapo.github.io/" target="_self">Home</a></li><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/js/" target="_self">JS</a></li><li class="has-submenu"><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/machine-learning/" target="_self" aria-haspopup="true">AI</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/abm/" target="_self">ABM</a></li><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/nlp/" target="_self">NLP</a></li><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/geneticalgorithms/" target="_self">Genetic Algorithms</a></li></ul></li><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/golang/" target="_self">Golang</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." aria-label="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/indice.png" srcset="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-xs.png 300w, https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-sm.png 480w, https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-md.png 768w, https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-lg.png 1024w, https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-xl.png 1360w, https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/media/posts/1/responsive/indice-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="225" width="225" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-12-07T02:14">December 7, 2019</time></div><h1>Recommendation Systems in GCP</h1><div class="post__meta post__meta--author"><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/authors/jaume-cloquell-capo/" class="feed__author invert">jaume cloquell capo</a></div></div></header></div><div class="wrapper post__entry"><p>In this section, we will review product recommendations using Cloud SQL and Apache Spark.</p><h1 id="recommendation-systems">Recommendation Systems</h1><h2 id="business-applications">Business applications</h2><p>E-commerce is probably the most common recommendation systems that we encounter. Models learn what we may like based on our preferences. We can give implicit or explicit feedback to the model (click, rating…).</p><p>Recommendations systems are used for :</p><ul><li>Google search results</li><li>Facebook feed</li><li>Netflix recommendation</li><li>Smart Reply in Gmail</li><li>Photo grouping in Google Photo</li><li>Restaurant recommendation system in Google Maps</li><li>…</li></ul><p>Recommendation systems must scale to meet demand.</p><h2 id="machine-learning">Machine learning</h2><p>Suppose that we will try to build a recommender system for housing rental.</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_48.jpg" data-is-external-image="true" alt="image"></p><p>Suppose that we have ratings provided manually by users as training data. These ratings could come from explicit ratings. Maybe we showed the user the house in the past and they’ve clicked four stars after seeing the house details, or the ratings have come from implicit ratings. Maybe they’ve spent a lot of time looking at the website corresponding to this property.</p><p>We then train an ML model to predict the user’s rating of every single house in the catalog and return the 5 houses with the highest grades. We have 2 kinds of training data :</p><ul><li>the previous ratings of the specific user</li><li>the ratings other people gave to each house</li></ul><p>One of the main issues is sparsity. Some houses might have a lot of reviews, other not. Some users might have a lot of users with similar profiles, others not. We need to cluster users and items at first.</p><p>Then, build the predicted rating as: <code class="language-plaintext highlighter-rouge">user-preference * item-quality</code>.</p><p>How often and where will we compute the predicted ratings?</p><ul><li>Stream : Continuously train the models</li><li>Batch : Train the model once a day or once a week. This is the selected approach.</li></ul><p>We should consider making the computations in a Hadoop Cluster to compute the rating every user would give to every house. Finally, we can store the predictions in Cloud SQL in a transactional way, or in any relational database management system.</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_49.jpg" data-is-external-image="true" alt="image"></p><h2 id="from-on-premise-to-gcp">From On-Premise to GCP</h2><p>Existing on-premise models might require a migration to GCP.</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_50.jpg" data-is-external-image="true" alt="image"></p><p>There are several storage solutions offered on GCP :</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_51.jpg" data-is-external-image="true" alt="image"></p><p>The storage solution to use is an important question :</p><ul><li>use Cloud Storage as a global file system</li><li>use CloudSQL as an RDBMS for transactional data up to a few Gb</li><li>use Datastore as a transactional NoSQL database system</li><li>use Bigtable for low-latency NoSQL data such as sensor data</li><li>use BigQuery as a SQL Data Warehouse to power analytics</li></ul><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_52.jpg" data-is-external-image="true" alt="image"></p><p>We, therefore, use CloudSQL in our example. Cloud SQL has a lot of advantage :</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_53.jpg" data-is-external-image="true" alt="image"></p><h2 id="utilizing-and-tuning-on-premise-clusters">Utilizing and tuning on-premise clusters</h2><p>When running jobs on your own clusters, there is a high chance that you either :</p><ul><li>underprovision your infrastructure, and your jobs would need more computing power</li><li>overprovision, in which case you are just wasting money</li></ul><p>With GCP, Hadoop Clusters can be seen as fungible resources. You run the clusters when you need to run jobs, and turn them off otherwise. With scheduled deletion, you can automate when the clusters need to be shut down. You can set shutdown triggers based on time, completion of a job…</p><p>Cloud DataProc AutoScaling provides flexible capacities :</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_64.jpg" data-is-external-image="true" alt="image"></p><p>With AutoScaling, you cannot store the data on the cluster, but we use Cloud Storage or BigTable instead.</p><p>Moreover, you can incorporate preemptible virtual machines into your cluster architecture. Preemptible VMs are highly affordable, short-lived compute instances that are suitable for batch jobs and fault-tolerant workloads. They last only up to 24 hours and they can be taken away whenever somebody else comes along and offers up new compute needs for them. So if your applications are fault tolerant, and Hadoop applications are, then preemptible instances can reduce your Compute Engine costs significantly.</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_65.jpg" data-is-external-image="true" alt="image"></p><p>Again, since these machines are temporary, you need to store data off-cluster.</p><h2 id="move-storage-off-cluster-with-google-cloud-storage">Move storage off-cluster with Google Cloud Storage</h2><p>Google’s data center network speed enables separation of compute and storage. In other words, we process the data where it is without copying it.</p><p>We HDFS only on the cluster for working storage, storage during processing, but we will store all actual input and output data on Google Cloud storage.</p><p>Since the input and output data are off the cluster, the cluster can be created for a single job or type of workload and can be shut down when not in use. DataProc relies on Cloud Storage, BigTable and BigQuery for storage.</p><p><img loading="lazy" src="https://maelfabien.github.io/assets/images/gcp_66.jpg" data-is-external-image="true" alt="image"></p><p>Storage using off-cluster options is usually cheaper since the disks themselves are cheaper, and the computing units can be shut down when not in use.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on December 7, 2019</p><ul class="post__tag"><li><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/road-to-google-cloud-platform-certification/">Road to Google Cloud Platform Certification</a></li></ul><div class="post__share"><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2FjaumeCloquellCapo.github.io%2FjaumeCloquellCapo.github.io%2Frecommendation-systems-in-gcp-week-1-module-2.html&amp;title=Recommendation%20Systems%20in%20GCP" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/authors/jaume-cloquell-capo/" class="invert" rel="author">jaume cloquell capo</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/la-simulacion-social-una-nueva-via-para-el-marketing.html" class="invert post__nav-link" rel="prev"><span>Previous</span> La simulación social. ¿Una nueva vía para el marketing?</a></div><div class="post__nav-next"><a href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/from-zero-to-an-apache-spark-job.html" class="invert post__nav-link" rel="next"><span>Next</span> Running a Apache Spark job on Cloud DataProc </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__comments"><div class="wrapper"><h2 class="h5">Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/recommendation-systems-in-gcp-week-1-module-2.html';
               		this.page.identifier = '1';
                   };
               
                   var disqus_loaded = false;
               
                   function publiiLoadDisqus() {
                       if(disqus_loaded) {
                           return false;
                       }
               
                       var top = document.getElementById('disqus_thread').offsetTop;
               
                       if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                           disqus_loaded = true;
               
                           (function () {
                               var d = document, s = d.createElement('script');
                               s.src = 'https://'+'https-jaumecloquellcapo-github-io'.trim()+'.disqus.com/embed.js';
                               s.setAttribute('data-timestamp', +new Date());
                               (d.head || d.body).appendChild(s);
                           })();
                       }
                   }
               
                   publiiLoadDisqus();
               
                   window.onscroll = function() {
                       publiiLoadDisqus();
                   };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noreferrer">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__social"><a href="https://www.linkedin.com/in/jaume-cloquell-119765b7" aria-label="LinkedIn"><svg><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright"><p>jaume cloquell capo</p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'overlay',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://jaumeCloquellCapo.github.io/jaumeCloquellCapo.github.io/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                    var checkedGroups = popup.querySelectorAll('input[type="checkbox"]:checked');

                    for (var i = 0; i < checkedGroups.length; i++) {
                        var allowedGroup = checkedGroups[i].name.replace('gdpr-', '');

                        if (allowedGroup !== '-' && allowedGroup !== '') {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');
                        var checkedCheckboxes = popup.querySelectorAll('input[type="checkbox"]:checked');

                        for (var j = 0; j < checkedCheckboxes.length; j++) {
                            var name = checkedCheckboxes[j].name.replace('gdpr-', '');

                            if (allowedGroups.indexOf(name) === -1) {
                                checkedCheckboxes[j].checked = false;
                            }
                        }

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>